{"assignees":[],"author":{"id":"MDQ6VXNlcjIwNzQxOTA5","is_bot":false,"login":"calebwin","name":"Caleb Winston"},"body":"The row-group-level filtered reading for Parquet that is introduced by #5843 creates an issue of duplicate metadata (metadata is stored in the footers of Parquet files) reading in the case when filters are specified. Arrow is used to read metadata and select a subset of data to read given user-provided filters [4] . Information about this subset is then passed to libcudf which reads in the subset [5]. The issue is that metadata gets read twice - first when Arrow reads metadata to do filtering and second when libcudf reads data.\r\n\r\nThis issue was initially raised here [1].\r\n\r\n# What to profile\r\n\r\n- [ ] Perf penalty of reading metadata using Arrow for filtering in the same vein as [2] but with datasets of varying # of files\r\n- [ ] Perf penalty of parsing metadata buffer [3] as fraction of total time Arrow spends reading metadata\r\n\r\n# What to determine\r\n\r\n- [ ] Determine whether or not perf penalty of the additional reading of metadata using Arrow is significant\r\n- [ ] Determine whether the duplicate reading should be resolved by passing metadata struct (steps to implement [6]) or metadata buffer (which is then parsed into metadata struct in libcudf) (steps to implement [7]) from Arrow `Dataset` to libcudf reader functions\r\n\r\n# Relevant discussion/code\r\n\r\n[1] https://github.com/rapidsai/cudf/pull/5843#discussion_r467191621\r\n[2] https://github.com/rapidsai/cudf/pull/5843#issuecomment-673566456\r\n[3] https://github.com/apache/arrow/blob/2e6009621011d7df43882aa883905b84d1647018/cpp/src/parquet/file_reader.cc#L532\r\n[4] https://github.com/rapidsai/cudf/pull/5843/files#diff-deac873508aaa12ca2e7c0a2c9035230R316\r\n[5] https://github.com/rapidsai/cudf/pull/5843/files#diff-deac873508aaa12ca2e7c0a2c9035230R359-R375\r\n[6] https://github.com/rapidsai/cudf/pull/5843#issuecomment-674437264\r\n[7] https://github.com/rapidsai/cudf/pull/5843#issuecomment-674437709","closed":false,"closedAt":null,"comments":[{"id":"MDEyOklzc3VlQ29tbWVudDc4MDEyMzgyMQ==","author":{"login":"github-actions"},"authorAssociation":"NONE","body":"This issue has been marked rotten due to no recent activity in the past 90d. Please close this issue if no further response or action is needed. Otherwise, please respond with a comment indicating any updates or changes to the original issue and/or confirm this issue still needs to be addressed.","createdAt":"2021-02-16T21:18:17Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/6004#issuecomment-780123821","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps50MruX","author":{"login":"GregoryKimball"},"authorAssociation":"CONTRIBUTOR","body":"Hello @wence- , now that #15028 is merged, would you please let me know if cuDF-python is still reading parquet row group metadata using pyarrow? Or is that step completely removed?","createdAt":"2024-02-16T23:31:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/6004#issuecomment-1949481879","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps50OY3m","author":{"login":"wence-"},"authorAssociation":"CONTRIBUTOR","body":"> Hello @wence- , now that #15028 is merged, would you please let me know if cuDF-python is still reading parquet row group metadata using pyarrow? Or is that step completely removed?\r\n\r\nThat change just exposed the libcudf functionality, we haven't migrated to using it from cudf-python (partly due to #15051 )","createdAt":"2024-02-17T10:31:15Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/6004#issuecomment-1949928934","viewerDidAuthor":false}],"createdAt":"2020-08-17T19:09:26Z","id":"MDU6SXNzdWU2ODA0NjM3MzM=","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjE=","name":"feature request","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxMTM5NzQwNjY2","name":"libcudf","description":"Affects libcudf (C++/CUDA) code.","color":"c5def5"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"},{"id":"MDU6TGFiZWwxMTg1MjQ0MTQy","name":"cuIO","description":"cuIO issue","color":"fef2c0"}],"milestone":{"number":22,"title":"Parquet continuous improvement","description":"","dueOn":null},"number":6004,"projectCards":[{"project":{"name":"Feature Planning"},"column":{"name":"Needs prioritizing"}}],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[FEA] Profiling duplicate reading of metadata","updatedAt":"2024-02-17T10:31:15Z","url":"https://github.com/rapidsai/cudf/issues/6004"}
