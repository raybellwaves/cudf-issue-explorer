{"assignees":[{"id":"MDQ6VXNlcjMwMTk2NjU=","login":"jakirkham","name":""}],"author":{"id":"MDQ6VXNlcjMyMzY4Mjc=","is_bot":false,"login":"daxiongshu","name":"Jiwei Liu"},"body":"**Describe the bug**\r\n`dask_cudf.DataFrame.values` shows `chunktype` of `numpy.ndarray` but it is actually `cupy.ndarray`.\r\n\r\n**Steps/Code to reproduce bug**\r\n```\r\nimport cudf\r\nimport dask_cudf\r\ndf = cudf.DataFrame({'a': list(range(20)),\r\n'b': list(reversed(range(20))),\r\n'c': list(range(20))})\r\nddf = dask_cudf.from_cudf(df, npartitions=2)\r\nprint(ddf.values)\r\n\r\ndask.array<values, shape=(nan, 3), dtype=int64, chunksize=(nan, 3), chunktype=numpy.ndarray>\r\n```\r\n**Expected behavior**\r\nThe chunktype should be `cupy.ndarray`\r\n\r\n**Environment overview (please complete the following information)**\r\n - Environment location: Bare-metal\r\n - Method of cuDF install: conda\r\n\r\n**Environment details**\r\ncudf `0.12.0`. cuda 10.0. python 3.7\r\n\r\n","closed":false,"closedAt":null,"comments":[{"id":"MDEyOklzc3VlQ29tbWVudDYwODAxNjUwOQ==","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"In discussion with @galipremsagar offline, it appears this is related to issue ( https://github.com/dask/dask/issues/5606 ). PR ( https://github.com/dask/dask/pull/5628 ) attempts to fix that issue, but appears to have stalled out.\r\n\r\ncc @quasiben (for awareness)","createdAt":"2020-04-02T18:04:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-608016509","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYwODAyMTg5OQ==","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"As a workaround, @daxiongshu, you could replace the array's `_meta` with a CuPy array. Here's an example using the code above.\r\n\r\n```python\r\nimport cupy\r\nimport cudf\r\nimport dask_cudf\r\n\r\ndf = cudf.DataFrame({\r\n    \"a\": list(range(20)),\r\n    \"b\": list(reversed(range(20))),\r\n    \"c\": list(range(20))\r\n})\r\nddf = dask_cudf.from_cudf(df, npartitions=2)\r\n\r\ndv = ddf.values\r\ndv._meta = cupy.asarray(dv._meta)\r\n```\r\n\r\ncc @pentschev (in case you have other thoughts here)","createdAt":"2020-04-02T18:14:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-608021899","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYwODA4MTA5MQ==","author":{"login":"pentschev"},"authorAssociation":"MEMBER","body":"I think your summary is correct @jakirkham , if that's a blocker we should try to push for those fixes to be merged.","createdAt":"2020-04-02T20:23:03Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-608081091","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDYwODEyMzc2MQ==","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"Based on discussion with @daxiongshu offline, it sounds like [the workaround]( https://github.com/rapidsai/cudf/issues/4309#issuecomment-608021899 ) was sufficient for now. Though agree it would be good to get a proper fix upstream.","createdAt":"2020-04-02T22:26:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-608123761","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDcwNjM2MjMxNQ==","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"> In discussion with @galipremsagar offline, it appears this is related to issue ( https://github.com/dask/dask/issues/5606 ). PR ( https://github.com/dask/dask/pull/5628 ) attempts to fix that issue, but appears to have stalled out.\r\n>\r\n> cc @quasiben (for awareness)\r\n\r\nThat PR has just now been merged. So should be fixed in the next Dask release.","createdAt":"2020-10-09T19:24:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-706362315","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc5ODk2MjczMQ==","author":{"login":"github-actions"},"authorAssociation":"NONE","body":"This issue has been labeled `inactive-90d` due to no recent activity in the past 90 days. Please close this issue if no further response or action is needed. Otherwise, please respond with a comment indicating any updates or changes to the original issue and/or confirm this issue still needs to be addressed.","createdAt":"2021-03-14T19:14:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-798962731","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDc5ODk2Mjc0MA==","author":{"login":"github-actions"},"authorAssociation":"NONE","body":"This issue has been labeled `inactive-30d` due to no recent activity in the past 30 days. Please close this issue if no further response or action is needed. Otherwise, please respond with a comment indicating any updates or changes to the original issue and/or confirm this issue still needs to be addressed. This issue will be labeled `inactive-90d` if there is no activity in the next 60 days.","createdAt":"2021-03-14T19:14:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-798962740","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgwNDY0MzY3NA==","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"Am still seeing the same issue that Jiwei saw. Maybe there is something needed in Dask-cuDF. @rjzamora do you know? ðŸ™‚","createdAt":"2021-03-23T06:05:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-804643674","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxMDIyNzIxMw==","author":{"login":"jacobtomlinson"},"authorAssociation":"MEMBER","body":"I also came across this problem today.","createdAt":"2021-03-30T13:13:42Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-810227213","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxMDQ0NTE3Mw==","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"I poked through the code on the Dask side and concluded this makes more sense to fix in Dask-cuDF. AFAICT the workaround noted above is a sufficient fix. So just implemented `values` using that ( https://github.com/rapidsai/cudf/pull/7760 )\r\n\r\nWould add that other functions like `to_dask_array` just call `.values`. Thus this same fix should fix that function and other similarly downstream functions as well","createdAt":"2021-03-30T17:32:28Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-810445173","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDgxMDQ1NjQyMQ==","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"NVM Keith made a good point in the other PR. Seems we can fix this upstream. Submitted PR ( https://github.com/dask/dask/pull/7486 )","createdAt":"2021-03-30T17:49:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-810456421","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg0OTMwOTQ0Mg==","author":{"login":"harrism"},"authorAssociation":"MEMBER","body":"@jakirkham was this bug fixed by #7760 or not?","createdAt":"2021-05-27T04:26:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-849309442","viewerDidAuthor":false},{"id":"MDEyOklzc3VlQ29tbWVudDg0OTc1MzcxMA==","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"No there's an upstream PR ( https://github.com/dask/dask/pull/7399 ) that is needed","createdAt":"2021-05-27T16:01:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-849753710","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5M2jAt","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"@jakirkham the upstream PR here has stalled. Do you know how we should follow up/whether we should still expect any progress there? Should we loop in other dask cudf devs?","createdAt":"2022-10-24T17:36:50Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-1289367597","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5M5rUX","author":{"login":"jakirkham"},"authorAssociation":"MEMBER","body":"AFAIU the folks involved in that PR are simply busy with other things atm. My guess is if folks here want to pick up the upstream PR that would be welcome ðŸ™‚","createdAt":"2022-10-25T08:33:23Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-1290188055","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5M9Wry","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"I was specifically concerned about [the last comment about extension arrays](https://github.com/dask/dask/pull/7399#issuecomment-864078866). Do you recall if that was specifically talking about pandas ExtensionArray types, or does that also impact cupy? If it's the latter then I assume that the upstream change wouldn't help us.","createdAt":"2022-10-25T21:14:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/4309#issuecomment-1291152114","viewerDidAuthor":false}],"createdAt":"2020-03-03T00:25:58Z","id":"MDU6SXNzdWU1NzQzMzc0ODQ=","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NTk=","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"},{"id":"MDU6TGFiZWwxMTg1MjQwODk4","name":"dask","description":"Dask issue","color":"fcc25d"}],"milestone":null,"number":4309,"projectCards":[{"project":{"name":"Bug Squashing"},"column":{"name":"Needs prioritizing"}}],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[BUG] dask_cudf.DataFrame.values shows chunktype of numpy ndarray","updatedAt":"2022-10-25T21:14:39Z","url":"https://github.com/rapidsai/cudf/issues/4309"}
