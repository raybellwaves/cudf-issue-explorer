{"assignees":[],"author":{"id":"MDQ6VXNlcjczMDQ1ODI=","is_bot":false,"login":"shrshi","name":"Shruti Shivakumar"},"body":"**Is your feature request related to a problem? Please describe.**\r\nWhen the class constructor is implicitly called (when the object is passed-by-value, for instance), the constructor is called with the default stream, and not the CUDA stream passed by the user on which the algorithm is running. \r\n`string_scalar(string_scalar const& other,\r\n                rmm::cuda_stream_view stream        = cudf::get_default_stream(),\r\n                rmm::mr::device_memory_resource* mr = rmm::mr::get_current_device_resource());`\r\n\r\n**Describe the solution you'd like**\r\nConsider requiring stream to be passed to constructor by making it a non-default argument.\r\n`string_scalar(string_scalar const& other,\r\n                rmm::cuda_stream_view stream ,\r\n                rmm::mr::device_memory_resource* mr = rmm::mr::get_current_device_resource());\r\n`\r\n\r\n**Describe alternatives you've considered**\r\nNone\r\n\r\n**Additional context**\r\nNone\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5ri2vu","author":{"login":"GregoryKimball"},"authorAssociation":"CONTRIBUTOR","body":"I believe https://github.com/rapidsai/cudf/pull/14354 will address this","createdAt":"2023-11-09T17:57:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14333#issuecomment-1804299246","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5r4VVJ","author":{"login":"karthikeyann"},"authorAssociation":"CONTRIBUTOR","body":"#14354 replaces all such occurences but it does not remove the default argument.\r\nRemoving default value for stream in scalars, is good suggestion. `column` also has similar copy constructor with defaulted `stream` argument. should similar removal be done for it too?","createdAt":"2023-11-14T10:23:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14333#issuecomment-1809929545","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5r5JVd","author":{"login":"davidwendt"},"authorAssociation":"CONTRIBUTOR","body":"These are public interfaces and all public APIs currently have defaulted stream parameters. \r\nWouldn't removing the default break many upstream callers? \r\nSpecifically, the cuDF Cython and Python layers would be required to manufacture a stream to create a scalar?\r\nI don't think we should remove the default from any specific public interfaces unless we consider removing them from all perhaps.","createdAt":"2023-11-14T12:48:11Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/rapidsai/cudf/issues/14333#issuecomment-1810142557","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5r51xr","author":{"login":"karthikeyann"},"authorAssociation":"CONTRIBUTOR","body":"> Specifically, the cuDF Cython and Python layers would be required to manufacture a stream to create a scalar?\r\n\r\nRight. We can't remove stream from scalar methods or any other public interfaces. \r\n\r\ncudf data types does not store streams (scalar, column, table, groupby). https://docs.rapids.ai/api/libcudf/nightly/developer_guide (libcudf API and Implementation â†’ Streams). streams are passed to libcudf APIs. So, storing them inside data structure doesn't align well, and also execution should use stream (including memory allocation), IMO, data structures should not hold streams (although rmm differs from this). The constructors are called with streams because memory allocation and copy will execute on streams.","createdAt":"2023-11-14T14:26:28Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14333#issuecomment-1810324587","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5r6UVZ","author":{"login":"karthikeyann"},"authorAssociation":"CONTRIBUTOR","body":"It's made clear than the default arguments on public APIs can't be removed without a breaking change.\r\nClarification on the issue title:\r\n>Stream-preserving constructors for scalar class and its derived classes \r\n\r\nDoes this mean to propose storing streams inside scalar class?","createdAt":"2023-11-14T15:24:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14333#issuecomment-1810449753","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5sE7_I","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"Could we take a step back here and ask why\r\n\r\n> When the class constructor is implicitly called (when the object is passed-by-value, for instance)\r\n\r\nis happening at all? cudf APIs are generally designed so that APIs should accept views rather than values. We don't have a `scalar_view` type (for [reasons](https://github.com/rapidsai/cudf/issues/6558)) but we typically handle this by instead passing references to scalar objects. Are there places where we really should be passing scalars by value? If so, why? Perhaps I'm missing something obvious, but this seems like potentially a design smell to me. If a scalar is passed by value and a copy constructor is called that implies the construction of a new scalar and a new device allocation, which isn't usually desirable.\r\n\r\nIOW I don't know if there's a good reason for the copy constructor to not be explicit in the long run. [I made the same point in a comment on the corresponding PR as well](https://github.com/rapidsai/cudf/pull/14354#issuecomment-1813162939).","createdAt":"2023-11-15T20:42:27Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14333#issuecomment-1813233608","viewerDidAuthor":false}],"createdAt":"2023-10-25T23:44:00Z","id":"I_kwDOBWUGps50-Nco","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjE=","name":"feature request","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxMDEzOTg3NTAz","name":"2 - In Progress","description":"Currently a work in progress","color":"fef2c0"},{"id":"MDU6TGFiZWwxMTM5NzQwNjY2","name":"libcudf","description":"Affects libcudf (C++/CUDA) code.","color":"c5def5"}],"milestone":null,"number":14333,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[FEA] Stream-preserving constructors for scalar class and its derived classes","updatedAt":"2023-11-15T20:43:08Z","url":"https://github.com/rapidsai/cudf/issues/14333"}
