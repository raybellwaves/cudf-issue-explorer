{"assignees":[],"author":{"id":"MDQ6VXNlcjEzNTIxMDA4","is_bot":false,"login":"isVoid","name":"Michael Wang"},"body":"**Describe the bug**\r\nWhen setting the `name` attribute for `df.index`, the name of the index is supposed to update. When following the reproducer below, it doesn't work as expected.\r\n\r\n**Steps/Code to reproduce bug**\r\n```python\r\nimport pandas as pd\r\n\r\ndf1 = pd.DataFrame(columns=[\"x\"], dtype=\"int64\")\r\ndf2 = df1.dtypes\r\ndf3 = df2.reset_index()\r\n\r\ndf3.index.name = \"indexer\"\r\nassert df3.index.name == \"indexer\"\r\n```\r\n\r\n**Expected behavior**\r\nNo exception should be thrown from above.\r\n\r\n**Environment overview (please complete the following information)**\r\nBare-metal, conda\r\n\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5tL60e","author":{"login":"wence-"},"authorAssociation":"CONTRIBUTOR","body":"This is, approximately, because `df2` has a column that is not representable as a fast object. Simpler example:\r\n\r\n```\r\ns = pd.Series([object()])\r\ns.index.name = \"what\"\r\nprint(s.index.name) # => None\r\n```\r\n\r\nI think what happens is that `s.index` provokes a fast->slow conversion (so that `s._fsproxy_state` is slow). But then we have a \"final\" object at this point, so we then do `index.name = \"what\"` and that pushes the index to cudf, sets the name there. But now this destroyed the link between `s.index` and the name we set.","createdAt":"2023-11-29T12:52:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14524#issuecomment-1831841054","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5tMgao","author":{"login":"shwina"},"authorAssociation":"CONTRIBUTOR","body":"Yeah we might need a custom `name` setter and getter for our proxy index type, given how common this operation is and we need to support it correctly.","createdAt":"2023-11-29T14:24:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14524#issuecomment-1831995048","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5tPgXJ","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"> I think what happens is that s.index provokes a fast->slow conversion (so that s._fsproxy_state is slow).\r\n\r\nI'm confused, shouldn't the original object in this case already be a slow object? In which case `s.index` should also be a slow object. And then what triggers the final slow->fast conversion when doing `s.index.name = \"what\"`?","createdAt":"2023-11-29T22:10:08Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14524#issuecomment-1832781257","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5tTLsH","author":{"login":"wence-"},"authorAssociation":"CONTRIBUTOR","body":"There are two things at work:\r\n\r\n1. The series is not representable as a fast object\r\n2. The index is representable as a fast object\r\n\r\nA method call on the series will first attempt to copy slow-to-fast, fail, and then call the slow method and wrap up the result. The return value is in the slow state. But, the index can be fast, so when we call a method on the index that attempts a slow-to-fast copy, succeeds, and calls the fast method. The index object is now in the fast state.\r\n\r\nNow, the problem is that we modified the internal state of the return value of `s.index`. But, `s.index` is a property, so the next time we call it, we'll attempt a slow-to-fast copy of `s`, fail, call the slow method, and wrap it up. With the consequence that `id(s.index) != id(s.index)`. Since at any one time a proxy object _either_ holds a fast object _or_ a slow object, any modifications we perform on the index we get back from `s.index` are not \"in-place\" in this scenario, and so don't propagate to the index that underlies `s`.\r\n```\r\nIn [72]: s = pd.Series([object()])\r\n\r\nIn [73]: i = s.index\r\n\r\nIn [74]: id(i._fsproxy_slow)\r\nOut[74]: 140540061935904\r\n\r\nIn [75]: i._fsproxy_state\r\nOut[75]: <_State.SLOW: 0>\r\n\r\nIn [76]: i.name = \"bar\"\r\n\r\nIn [77]: i._fsproxy_state\r\nOut[77]: <_State.FAST: 1>\r\n\r\nIn [78]: id(i._fsproxy_fast)\r\nOut[78]: 140540060927552\r\n\r\nIn [79]: id(s.index._fsproxy_slow)\r\nOut[79]: 140540061935904\r\n\r\nIn [80]: id(i)\r\nOut[80]: 140543720616288\r\n\r\nIn [81]: id(s.index)\r\nOut[81]: 140540061939936\r\n\r\nIn [82]: id(i._fsproxy_slow)\r\nOut[82]: 140540061938064\r\n```","createdAt":"2023-11-30T13:01:19Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14524#issuecomment-1833745159","viewerDidAuthor":false}],"createdAt":"2023-11-29T01:19:57Z","id":"I_kwDOBWUGps54I9ug","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NTk=","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"MDU6TGFiZWwxMDEzOTg3MzUy","name":"0 - Backlog","description":"In queue waiting for assignment","color":"d4c5f9"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"},{"id":"LA_kwDOBWUGps8AAAABlj4eYg","name":"cudf.pandas","description":"Issues specific to cudf.pandas","color":"984DFB"}],"milestone":null,"number":14524,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[BUG] `df.index.name = \"indexer\"` does not work as expected under `cudf.pandas`","updatedAt":"2024-05-24T16:01:22Z","url":"https://github.com/rapidsai/cudf/issues/14524"}
