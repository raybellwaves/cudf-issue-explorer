{"assignees":[],"author":{"id":"MDQ6VXNlcjQ4Mzc1NzE=","is_bot":false,"login":"VibhuJawa","name":"Vibhu Jawa"},"body":"**Describe the bug**\r\n\r\nfillna with dataframe containing list dtypes fails . \r\n\r\n**Steps/Code to reproduce bug**\r\n```python3\r\nimport cudf\r\ns1 = cudf.Series(['game', 'game', None,None,None])\r\ns2 = cudf.Series([[1], [1], None,None,None])\r\ndf = cudf.DataFrame({'_TYPE_':s1, 'h':s2})\r\n\r\nc1 = cudf.Series([None,None, 'user', 'user', 'user'])\r\nc2 = cudf.Series([None, None, [2], [2], [2]])\r\nsubdf = cudf.DataFrame({'_TYPE_':c1, 'h':c2})\r\ndf.fillna(subdf)\r\n```\r\n\r\n```python3\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\nCell In [23], line 9\r\n      7 c2 = cudf.Series([None, None, [2], [2], [2]])\r\n      8 subdf = cudf.DataFrame({'_TYPE_':c1, 'h':c2})\r\n----> 9 df.fillna(subdf)\r\n\r\nFile /datasets/vjawa/miniconda3/envs/cugraph_dgl_dev/lib/python3.9/contextlib.py:79, in ContextDecorator.__call__.<locals>.inner(*args, **kwds)\r\n     76 @wraps(func)\r\n     77 def inner(*args, **kwds):\r\n     78     with self._recreate_cm():\r\n---> 79         return func(*args, **kwds)\r\n\r\nFile /datasets/vjawa/miniconda3/envs/cugraph_dgl_dev/lib/python3.9/site-packages/cudf/core/indexed_frame.py:1842, in IndexedFrame.fillna(self, value, method, axis, inplace, limit)\r\n   1837 @_cudf_nvtx_annotate\r\n   1838 def fillna(\r\n   1839     self, value=None, method=None, axis=None, inplace=False, limit=None\r\n   1840 ):  # noqa: D102\r\n   1841     old_index = self._index\r\n-> 1842     ret = super().fillna(value, method, axis, inplace, limit)\r\n   1843     if inplace:\r\n   1844         self._index = old_index\r\n\r\nFile /datasets/vjawa/miniconda3/envs/cugraph_dgl_dev/lib/python3.9/contextlib.py:79, in ContextDecorator.__call__.<locals>.inner(*args, **kwds)\r\n     76 @wraps(func)\r\n     77 def inner(*args, **kwds):\r\n     78     with self._recreate_cm():\r\n---> 79         return func(*args, **kwds)\r\n\r\nFile /datasets/vjawa/miniconda3/envs/cugraph_dgl_dev/lib/python3.9/site-packages/cudf/core/frame.py:905, in Frame.fillna(self, value, method, axis, inplace, limit)\r\n    899 should_fill = (\r\n    900     col_name in value\r\n    901     and col.contains_na_entries\r\n    902     and not libcudf.scalar._is_null_host_scalar(replace_val)\r\n    903 ) or method is not None\r\n    904 if should_fill:\r\n--> 905     filled_data[col_name] = col.fillna(replace_val, method)\r\n    906 else:\r\n    907     filled_data[col_name] = col.copy(deep=True)\r\n\r\nFile /datasets/vjawa/miniconda3/envs/cugraph_dgl_dev/lib/python3.9/site-packages/cudf/core/column/column.py:609, in ColumnBase.fillna(self, value, method, dtype)\r\n    599 def fillna(\r\n    600     self: T,\r\n    601     value: Any = None,\r\n    602     method: str = None,\r\n    603     dtype: Dtype = None,\r\n    604 ) -> T:\r\n    605     \"\"\"Fill null values with ``value``.\r\n    606 \r\n    607     Returns a copy with null filled.\r\n    608     \"\"\"\r\n--> 609     return libcudf.replace.replace_nulls(\r\n    610         input_col=self, replacement=value, method=method, dtype=dtype\r\n    611     )\r\n\r\nFile replace.pyx:139, in cudf._lib.replace.replace_nulls()\r\n\r\nFile /datasets/vjawa/miniconda3/envs/cugraph_dgl_dev/lib/python3.9/site-packages/cudf/core/single_column_frame.py:95, in SingleColumnFrame.__bool__(self)\r\n     94 def __bool__(self):\r\n---> 95     raise TypeError(\r\n     96         f\"The truth value of a {type(self)} is ambiguous. Use \"\r\n     97         \"a.empty, a.bool(), a.item(), a.any() or a.all().\"\r\n     98     )\r\n\r\nTypeError: The truth value of a <class 'cudf.core.series.Series'> is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().\r\n```\r\n\r\n**Expected behavior**\r\n\r\nI expect this to work like it does for non list columns. \r\n\r\n```python3\r\nimport cudf\r\ns1 = cudf.Series(['game', 'game', None,None,None])\r\ns2 = cudf.Series([1, 1, None,None,None])\r\ndf = cudf.DataFrame({'_TYPE_':s1, 'h':s2})\r\n\r\nc1 = cudf.Series([None,None, 'user', 'user', 'user'])\r\nc2 = cudf.Series([None, None, 2, 2, 2])\r\nsubdf = cudf.DataFrame({'_TYPE_':c1, 'h':c2})\r\ndf.fillna(subdf)\r\n```\r\n```python3\r\n\t_TYPE_\th\r\n0\tgame\t1\r\n1\tgame\t1\r\n2\tuser\t2\r\n3\tuser\t2\r\n4\tuser\t2\r\n```\r\n\r\n**Environment overview (please complete the following information)**\r\n - Method of cuDF install: [conda]\r\ncudf                      22.12.00a221128 cuda_11_py39_g0c60819cf3_305    rapidsai-nightly\r\n\r\n\r\n**Additional context**\r\n\r\nImpacts property graph in cugraph where we use it for replacing fillna \r\n\r\nhttps://github.com/rapidsai/cugraph/blob/cb0d0923616f656ec816f999aa633ecbf3c57267/python/cugraph/cugraph/structure/property_graph.py#L758\r\n\r\nhttps://github.com/rapidsai/cugraph/blob/cb0d0923616f656ec816f999aa633ecbf3c57267/python/cugraph/cugraph/structure/property_graph.py#L1155","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5RQSk2","author":{"login":"GregoryKimball"},"authorAssociation":"CONTRIBUTOR","body":"Thank you for posting this issue. `fillna` seems to be a function that has issues with list type support.\r\n\r\nFWIW here is a shorter repro:\r\n```\r\nimport cudf\r\ndf = cudf.DataFrame({'a':[[1], [1], None,None,None]})\r\nsubdf = cudf.DataFrame({'a':[None, None, [2], [2], [2]]})\r\ndf.fillna(subdf)\r\n```","createdAt":"2022-12-22T18:44:55Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/rapidsai/cudf/issues/12274#issuecomment-1363224886","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5YPlW8","author":{"login":"eriknw"},"authorAssociation":"CONTRIBUTOR","body":"Bump.\r\n\r\nxref: https://github.com/rapidsai/cugraph/issues/3010\r\n\r\nOther examples using `cudf.Series`:\r\n```python\r\nimport cudf\r\n\r\ns = cudf.Series([[1], None, [3], None])\r\nt = cudf.Series([None, [2], None, [4]])\r\n\r\n# These all fail\r\ns.fillna(t)\r\ns.fillna(cudf.Scalar([0]))\r\ns.fillna([0])\r\ns[s.isnull()] = t\r\ns[s.isnull()] = t[s.isnull()]\r\n\r\n## These work:\r\n# s[s.isnull()] = [0]\r\n# t[t.isnull()] = cudf.Scalar([0])\r\n```\r\nIt would be straightforward to add the Python layer for this (probably add `ListColumn.fillna`), but it would still need a low-level implementation (perhaps in CUDA called from `cpp/src/replace/nulls.cu:replace_nulls_column_kernel_forwarder`).","createdAt":"2023-03-23T02:05:45Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/12274#issuecomment-1480480188","viewerDidAuthor":false}],"createdAt":"2022-11-30T21:44:12Z","id":"I_kwDOBWUGps5XokoQ","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NTk=","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"MDU6TGFiZWwxMDEzOTg3MzUy","name":"0 - Backlog","description":"In queue waiting for assignment","color":"d4c5f9"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"}],"milestone":{"number":2,"title":"List and Struct data types and operations","description":"","dueOn":null},"number":12274,"projectCards":[{"project":{"name":"Bug Squashing"},"column":{"name":"Needs prioritizing"}}],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[BUG] fillna with dataframe containing list dtypes fails ","updatedAt":"2023-03-23T02:05:45Z","url":"https://github.com/rapidsai/cudf/issues/12274"}
