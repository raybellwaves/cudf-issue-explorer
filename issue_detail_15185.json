{"assignees":[],"author":{"id":"MDQ6VXNlcjE2MDA1Njkw","is_bot":false,"login":"vuule","name":"Vukasin Milovanovic"},"body":"When reading a byte range from a file, JSON reader has to read data beyond the actual byte range to get the remainder of the last row that starts within the range. In order to find the end of this row, current implementation reads the next byte range. Once the reader finds the delimiter, it reads the full required range of data, discarding everything previously read.\r\nThis leads to 3x data read in most cases: \r\nhttps://github.com/rapidsai/cudf/blob/branch-24.04/cpp/src/io/json/read_json.cu#L162-L202\r\nWe could implement a solution that reads additional data in smaller chunks and does not discard the byte range that was initially read. Once we find the next delimiter, we can concatenate all required data into a single buffer. This does include a D2D copy of all data, but this will be a lot faster than IO or the H2D copy that we now make. With this, we can limit the IO to just the requested byte range + few extra KBs. ","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps51cBZ6","author":{"login":"vuule"},"authorAssociation":"CONTRIBUTOR","body":"An interesting interaction with https://github.com/rapidsai/cudf/issues/15186: datasource can prevent full reading of the next byte range by limiting the returned data to the mapped range. This means that fixing https://github.com/rapidsai/cudf/issues/15186 would increase the IO overhead in this issue.","createdAt":"2024-02-29T02:23:33Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15185#issuecomment-1970280058","viewerDidAuthor":false}],"createdAt":"2024-02-29T02:13:59Z","id":"I_kwDOBWUGps6AwkmA","labels":[{"id":"MDU6TGFiZWwxMTM5NzQwNjY2","name":"libcudf","description":"Affects libcudf (C++/CUDA) code.","color":"c5def5"},{"id":"MDU6TGFiZWwxMTg1MjQ0MTQy","name":"cuIO","description":"cuIO issue","color":"fef2c0"},{"id":"MDU6TGFiZWwxMzIyMjUyNjE3","name":"Performance","description":"Performance related issue","color":"C2E0C6"}],"milestone":{"number":13,"title":"Nested JSON reader","description":"Data-parallel reader for nested JSON text data","dueOn":null},"number":15185,"projectCards":[],"projectItems":[],"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"OPEN","title":"Reduce IO when `byte_range` option is used in `read_json`","updatedAt":"2024-02-29T21:39:11Z","url":"https://github.com/rapidsai/cudf/issues/15185"}
