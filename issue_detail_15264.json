{"assignees":[],"author":{"id":"MDQ6VXNlcjMyOTA4MzU1","is_bot":false,"login":"nurmanmus","name":""},"body":"**Missing Pandas Feature Request**\r\nA clear and concise summary of the pandas function(s) you'd like to be able run with cuDF.\r\nDataFrame.pivot_table not supported in Cudf\r\n\r\n**Profiler Output**\r\nIf you used the profiler in pandas accelerator mode, please provide the full output of your profiling report.\r\n```\r\n┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓\r\n┃ Function                  ┃ GPU ncalls ┃ GPU cumtime ┃ GPU percall ┃ CPU ncalls ┃ CPU cumtime ┃ CPU percall ┃\r\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩\r\n│ DataFrame.pivot_table     │ 0          │ 0.000       │ 0.000       │ 1          │ 0.076       │ 0.076       │\r\n│ DataFrame.reset_index     │ 1          │ 0.003       │ 0.003       │ 0          │ 0.000       │ 0.000       │\r\n│ merge                     │ 1          │ 1.164       │ 1.164       │ 0          │ 0.000       │ 0.000       │\r\n│ DataFrame.drop_duplicates │ 1          │ 0.170       │ 0.170       │ 0          │ 0.000       │ 0.000       │\r\n│ DataFrame                 │ 1          │ 0.000       │ 0.000       │ 0          │ 0.000       │ 0.000       │\r\n│ DataFrame.__repr__        │ 1          │ 0.539       │ 0.539       │ 0          │ 0.000       │ 0.000       │\r\n└───────────────────────────┴────────────┴─────────────┴─────────────┴────────────┴─────────────┴─────────────┘\r\n```\r\nNot all pandas operations ran on the GPU. The following functions required CPU fallback:\r\n\r\n- DataFrame.pivot_table\r\n\r\n**Additional context**\r\nAdd any other context, code examples, or references to existing implementations about the feature request here.\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps52bO9N","author":{"login":"bdice"},"authorAssociation":"CONTRIBUTOR","body":"@nurmanmus Thanks for this issue. Could you share the function parameters you passed? The pivot table function exists but does not support the full range of arguments on the GPU. See if you are using any of the options marked as unsupported in the cudf docs, and that will help us narrow down what features to prioritize: https://docs.rapids.ai/api/cudf/stable/user_guide/api_docs/api/cudf.dataframe.pivot_table/#cudf.DataFrame.pivot_table","createdAt":"2024-03-09T12:58:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15264#issuecomment-1986850637","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps52xeTT","author":{"login":"nurmanmus"},"authorAssociation":"NONE","body":"Sure, here are the code and parameters:\r\n\r\n```python\r\n# Create a pivot table with 'tag' as columns, and 'fp', 'ddate', 'qtrs' as index\r\npivot_df = filtered_df.pivot_table(index=['name', 'fp', 'ddate', 'qtrs'], columns='tag', values='value', aggfunc='first').reset_index()\r\npivot_df\r\n```","createdAt":"2024-03-12T22:23:43Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15264#issuecomment-1992680659","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps522qEj","author":{"login":"wence-"},"authorAssociation":"CONTRIBUTOR","body":"Thanks, unfortunately without a sample dataset, I can't yet reproduce this pivot table failure. Is it possible for you to share a more complete example that fails, that is, loading a dataset to produce `filtered_df` as a cudf DataFrame and then running the pivot-table command should produce an error (which is why you're seeing the fallback).\r\n\r\nThis is what I did, which _does_ work:\r\n```python\r\nimport cudf\r\n# make a trivial dataframe\r\ndf = cudf.DataFrame({\"a\": [\"a\", \"a\", \"b\", \"c\"], \"b\": [1, 1, 2, 3], \"c\": [1, 2, 3, 4], \"d\": [1, 4, 7, 8]})\r\npivoted = df.pivot_table(index=[\"a\", \"b\"], columns=\"c\", values=\"d\", aggfunc=\"first\")\r\n```\r\n\r\nMy _guess_ is that in your dataframe the `value` column is a list or struct column? And the `\"first\"` aggregation is unsupported.","createdAt":"2024-03-13T10:19:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15264#issuecomment-1994039587","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-Qxw-","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"@nurmanmus any thoughts on the above question?","createdAt":"2024-05-17T20:20:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15264#issuecomment-2118327358","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-SceJ","author":{"login":"nurmanmus"},"authorAssociation":"NONE","body":"Noted, I will get back to you on this.","createdAt":"2024-05-18T10:21:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/rapidsai/cudf/issues/15264#issuecomment-2118764425","viewerDidAuthor":false}],"createdAt":"2024-03-09T07:00:31Z","id":"I_kwDOBWUGps6Bw8hv","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjE=","name":"feature request","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxMDEzOTg3Nzk5","name":"0 - Waiting on Author","description":"Waiting for author to respond to review","color":"ffb88c"}],"milestone":null,"number":15264,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"DataFrame.pivot_table not supported in Cudf","updatedAt":"2024-05-18T10:21:11Z","url":"https://github.com/rapidsai/cudf/issues/15264"}
