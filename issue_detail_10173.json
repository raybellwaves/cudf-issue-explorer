{"assignees":[],"author":{"id":"MDQ6VXNlcjg0NTczODg=","is_bot":false,"login":"beckernick","name":"Nick Becker"},"body":"Today, Dask supports several groupby rolling operations on time frequency windows (e.g., \"1 hour\"), including canonical reductions like sum, max, min, mean, std, and var.\r\n\r\nThese operations are not supported with dask-cuDF. We should support these operations.\r\n\r\nThey currently fail with the following error:\r\n\r\n```python\r\nimport dask\r\nimport dask_cudf\r\n​\r\nddf = dask.datasets.timeseries(freq=\"1H\")\r\ngddf = dask_cudf.from_dask_dataframe(ddf)\r\n​\r\nprint(ddf.groupby(\"name\").x.rolling(\"1D\").var().head())\r\n​\r\ngddf.groupby(\"name\").x.rolling('1D').mean().head()\r\nname     timestamp          \r\nZelda    2000-01-01 00:00:00   NaN\r\nSarah    2000-01-01 01:00:00   NaN\r\nGeorge   2000-01-01 02:00:00   NaN\r\nNorbert  2000-01-01 03:00:00   NaN\r\nWendy    2000-01-01 04:00:00   NaN\r\nName: x, dtype: float64\r\n/home/nicholasb/conda/envs/cudf-22.04/lib/python3.8/site-packages/dask_cudf/groupby.py:54: FutureWarning: index is deprecated and will be removed in a future release.\r\n  by=self.index,\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\nInput In [16], in <module>\r\n      5 gddf = dask_cudf.from_dask_dataframe(ddf)\r\n      7 print(ddf.groupby(\"name\").x.rolling(\"1D\").var().head())\r\n----> 9 gddf.groupby(\"name\").x.rolling('1D').mean().head()\r\n\r\nFile ~/conda/envs/cudf-22.04/lib/python3.8/site-packages/dask/dataframe/rolling.py:352, in Rolling.mean(self)\r\n    350 @derived_from(pd_Rolling)\r\n    351 def mean(self):\r\n--> 352     return self._call_method(\"mean\")\r\n\r\nFile ~/conda/envs/cudf-22.04/lib/python3.8/site-packages/dask/dataframe/rolling.py:492, in RollingGroupby._call_method(self, method_name, *args, **kwargs)\r\n    491 def _call_method(self, method_name, *args, **kwargs):\r\n--> 492     return super()._call_method(\r\n    493         method_name,\r\n    494         *args,\r\n    495         groupby_kwargs=self._groupby_kwargs,\r\n    496         groupby_slice=self._groupby_slice,\r\n    497         **kwargs,\r\n    498     )\r\n\r\nFile ~/conda/envs/cudf-22.04/lib/python3.8/site-packages/dask/dataframe/rolling.py:300, in Rolling._call_method(self, method_name, *args, **kwargs)\r\n    298 def _call_method(self, method_name, *args, **kwargs):\r\n    299     rolling_kwargs = self._rolling_kwargs()\r\n--> 300     meta = self.pandas_rolling_method(\r\n    301         self.obj._meta_nonempty, rolling_kwargs, method_name, *args, **kwargs\r\n    302     )\r\n    304     if self._has_single_partition:\r\n    305         # There's no overlap just use map_partitions\r\n    306         return self.obj.map_partitions(\r\n    307             self.pandas_rolling_method,\r\n    308             rolling_kwargs,\r\n   (...)\r\n    313             **kwargs,\r\n    314         )\r\n\r\nFile ~/conda/envs/cudf-22.04/lib/python3.8/site-packages/dask/dataframe/rolling.py:488, in RollingGroupby.pandas_rolling_method(df, rolling_kwargs, name, groupby_kwargs, groupby_slice, *args, **kwargs)\r\n    486 if groupby_slice:\r\n    487     groupby = groupby[groupby_slice]\r\n--> 488 rolling = groupby.rolling(**rolling_kwargs)\r\n    489 return getattr(rolling, name)(*args, **kwargs).sort_index(level=-1)\r\n\r\nFile ~/conda/envs/cudf-22.04/lib/python3.8/site-packages/cudf/core/groupby/groupby.py:729, in GroupBy.rolling(self, *args, **kwargs)\r\n    720 def rolling(self, *args, **kwargs):\r\n    721     \"\"\"\r\n    722     Returns a `RollingGroupby` object that enables rolling window\r\n    723     calculations on the groups.\r\n   (...)\r\n    727     cudf.core.window.Rolling\r\n    728     \"\"\"\r\n--> 729     return cudf.core.window.rolling.RollingGroupby(self, *args, **kwargs)\r\n\r\nTypeError: __init__() got an unexpected keyword argument 'win_type'\r\n```\r\n\r\n\r\nEnv:\r\n<details>\r\nconda list | grep \"rapids\\|dask\"\r\ncudf                      22.04.00a220131 cuda_11_py38_gc25d35b361_93    rapidsai-nightly\r\ndask                      2022.1.0           pyhd8ed1ab_0    conda-forge\r\ndask-core                 2022.1.0           pyhd8ed1ab_0    conda-forge\r\ndask-cudf                 22.04.00a220131 cuda_11_py38_gc25d35b361_93    rapidsai-nightly\r\nlibcudf                   22.04.00a220131 cuda11_gc25d35b361_93    rapidsai-nightly\r\nlibrmm                    22.04.00a220131 cuda11_g81d523a_15    rapidsai-nightly\r\nptxcompiler               0.2.0            py38h98f4b32_0    rapidsai-nightly\r\nrmm                       22.04.00a220131 cuda11_py38_g81d523a_15_has_cma    rapidsai-nightly\r\n</details>","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps4_BYzq","author":{"login":"github-actions"},"authorAssociation":"NONE","body":"This issue has been labeled `inactive-30d` due to no recent activity in the past 30 days. Please close this issue if no further response or action is needed. Otherwise, please respond with a comment indicating any updates or changes to the original issue and/or confirm this issue still needs to be addressed. This issue will be labeled `inactive-90d` if there is no activity in the next 60 days.","createdAt":"2022-03-02T20:02:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/10173#issuecomment-1057328362","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5EGokd","author":{"login":"github-actions"},"authorAssociation":"NONE","body":"This issue has been labeled `inactive-90d` due to no recent activity in the past 90 days. Please close this issue if no further response or action is needed. Otherwise, please respond with a comment indicating any updates or changes to the original issue and/or confirm this issue still needs to be addressed.","createdAt":"2022-05-31T20:03:40Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/10173#issuecomment-1142589725","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5JBmPu","author":{"login":"entelechie"},"authorAssociation":"NONE","body":"Lacking of this basic functionaltiy makes cudf very difficult to use.","createdAt":"2022-08-24T03:49:38Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/10173#issuecomment-1225155566","viewerDidAuthor":false}],"createdAt":"2022-01-31T19:30:57Z","id":"I_kwDOBWUGps5Cv4b2","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjE=","name":"feature request","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"},{"id":"MDU6TGFiZWwxMTg1MjQwODk4","name":"dask","description":"Dask issue","color":"fcc25d"}],"milestone":null,"number":10173,"projectCards":[{"project":{"name":"Feature Planning"},"column":{"name":"Needs prioritizing"}}],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[FEA] Support for groupby rolling aggregations on time windows in dask-cudf","updatedAt":"2024-02-23T18:43:03Z","url":"https://github.com/rapidsai/cudf/issues/10173"}
