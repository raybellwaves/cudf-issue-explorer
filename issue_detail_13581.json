{"assignees":[],"author":{"id":"MDQ6VXNlcjEzMTMxMDk4","is_bot":false,"login":"ChrisJar","name":""},"body":"**Is your feature request related to a problem? Please describe.**\r\nI wish dask_cudf dataframes would support the `indicator=True` option in the merge function\r\n\r\n**Describe the solution you'd like**\r\nIn dask dataframe the code:\r\n```python\r\nimport pandas as pd\r\nimport dask.dataframe as dd\r\n\r\ndfa = pd.DataFrame({\"id\":[1,2,2,4], \"a\":[\"a\",\"b\",\"c\",\"d\"]})\r\ndfb = pd.DataFrame({\"id\":[2,3,3,4], \"b\":[\"e\",\"f\",\"g\",\"h\"]})\r\nddfa = dd.from_pandas(dfa, npartitions=1)\r\nddfb = dd.from_pandas(dfb, npartitions=1)\r\n\r\nddf = ddfa.merge(ddfb, on=\"id\", how=\"outer\", indicator=True)\r\nprint(ddf.compute())\r\n```\r\nreturns:\r\n```\r\n   id    a    b      _merge\r\n0   1    a  NaN   left_only\r\n1   2    b    e        both\r\n2   2    c    e        both\r\n3   4    d    h        both\r\n4   3  NaN    f  right_only\r\n5   3  NaN    g  right_only\r\n```\r\n\r\nbut in dask_cudf:\r\n```python\r\nimport cudf\r\nimport dask_cudf as dd\r\n\r\ndfa = cudf.DataFrame({\"id\":[1,2,2,4], \"a\":[\"a\",\"b\",\"c\",\"d\"]})\r\ndfb = cudf.DataFrame({\"id\":[2,3,3,4], \"b\":[\"e\",\"f\",\"g\",\"h\"]})\r\nddfa = dd.from_cudf(dfa, npartitions=1)\r\nddfb = dd.from_cudf(dfb, npartitions=1)\r\n\r\nddf = ddfa.merge(ddfb, on=\"id\", how=\"outer\", indicator=True)\r\nprint(ddf.compute())\r\n```\r\nthis throws a `NotImplementedError`:\r\n```\r\nTraceback (most recent call last):                                                                                                                             \r\n  File \"/raid/cjarrett/dask-sql/min.py\", line 13, in <module>     \r\n    ddf = ddfa.merge(ddfb, on=\"id\", how=\"outer\", indicator=True)\r\n  File \"/raid/cjarrett/mambaforge/envs/dsql-6-6/lib/python3.10/site-packages/nvtx/nvtx.py\", line 101, in inner\r\n    result = func(*args, **kwargs)\r\n  File \"/raid/cjarrett/mambaforge/envs/dsql-6-6/lib/python3.10/site-packages/dask_cudf/core.py\", line 121, in merge\r\n    return super().merge(\r\n  File \"/raid/cjarrett/mambaforge/envs/dsql-6-6/lib/python3.10/site-packages/dask/dataframe/core.py\", line 5644, in merge\r\n    return merge(\r\n  File \"/raid/cjarrett/mambaforge/envs/dsql-6-6/lib/python3.10/site-packages/dask/dataframe/multi.py\", line 724, in merge\r\n    return hash_join(\r\n  File \"/raid/cjarrett/mambaforge/envs/dsql-6-6/lib/python3.10/site-packages/dask/dataframe/multi.py\", line 398, in hash_join\r\n    meta = _lhs_meta.merge(_rhs_meta, **kwargs)\r\n  File \"/raid/cjarrett/mambaforge/envs/dsql-6-6/lib/python3.10/site-packages/nvtx/nvtx.py\", line 101, in inner\r\n    result = func(*args, **kwargs)\r\n  File \"/raid/cjarrett/mambaforge/envs/dsql-6-6/lib/python3.10/site-packages/cudf/core/dataframe.py\", line 3969, in merge\r\n    raise NotImplementedError(\r\nNotImplementedError: Only indicator=False is currently supported\r\n```\r\n\r\n\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5fNqLP","author":{"login":"wence-"},"authorAssociation":"CONTRIBUTOR","body":"This needs to happen in the `cudf` implementation of `merge` (which doesn't support `indicator` either). The implementation is relatively straightforward. You carry around an extra column that is `2^0` for the left frame, `2^1` for the right frame. Then you merge, and sum those columns (treating null as zero). Where this result column is `2^0`, the input only appeared in the left frame, where it is `2^1` it only appeared in the right frame, if it's `3`, it appeared in both. This can be encoded as a categorical column.\r\n\r\nCare to try implementing that (relevant code is in `cudf/python/core/join/join.py`)?","createdAt":"2023-06-19T15:51:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/rapidsai/cudf/issues/13581#issuecomment-1597416143","viewerDidAuthor":false}],"createdAt":"2023-06-14T21:07:36Z","id":"I_kwDOBWUGps5ow57_","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjE=","name":"feature request","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxMDEzOTg3MzUy","name":"0 - Backlog","description":"In queue waiting for assignment","color":"d4c5f9"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"},{"id":"MDU6TGFiZWwyNTQ2NTIxMDI0","name":"improvement","description":"Improvement / enhancement to an existing function","color":"bfd4f2"}],"milestone":{"number":5,"title":"Pandas API Alignment and Coverage","description":"","dueOn":null},"number":13581,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[FEA] Support indicator=True in cudf.DataFrame.merge","updatedAt":"2023-07-22T20:15:31Z","url":"https://github.com/rapidsai/cudf/issues/13581"}
