{"assignees":[],"author":{"id":"MDQ6VXNlcjIxMjczMjY2","is_bot":false,"login":"notwopr","name":"David Choi"},"body":"**Describe the bug**\r\nI load a pandas dataframe into cudf using cudf.from_pandas(originaldataframe) and it gives me a mixed type error.\r\n\r\n**Steps/Code to reproduce bug**\r\nOriginal Dataframe: \r\n```\r\n     symbol                                               name STOCK_TYPE  first_date   last_date    AGE                INDUSTRY   marketcap\r\n0     WHFBZ      WhiteHorse Finance, Inc. 6.50% Notes due 2025     common  2018-11-30  2021-12-16   1112                 Unknown    0.000000\r\n1       ANH                 Anworth Mortgage Asset Corporation     common  1998-03-12  2021-03-19   8408                 Unknown    0.000000\r\n2       CEE          The Central and Eastern Europe Fund, Inc.     common  1990-02-28  2024-01-09  12368        Asset Management    0.062059\r\n3      SEMR                             SEMrush Holdings, Inc.     common  2021-03-24  2024-01-09   1021  Software - Application    1.780361\r\n4      BWMX  Betterware de Mexico, S.A.P.I. de C.V. Ordinar...     common  2020-03-16  2024-01-09   1394        Specialty Retail    0.470934\r\n...     ...                                                ...        ...         ...         ...    ...                     ...         ...\r\n9281    GHI  Greystone Housing Impact Investors LP Benefici...     common  1986-04-02  2024-01-09  13796        Mortgage Finance    0.387465\r\n9282    LMT                              Lockheed Martin Corp.     common  1977-01-03  2024-01-09  17172     Aerospace & Defense  113.205101\r\n9283   ^DJI                                          Dow Jones      index  1970-01-02  2024-01-08  19729                   Index    0.000000\r\n9284   ^INX                                            S&P 500      index  1970-01-02  2024-01-08  19729                   Index    0.000000\r\n9285  ^IXIC                                             NASDAQ      index  1971-02-05  2024-01-08  19330                   Index    0.000000\r\n```\r\nI created the following function to create a dictionary of all the unique datatypes found for each column, even if there are more than one type in a single column.  Here's the function:\r\n```\r\ndef get_column_data_types(dataframe):\r\n    column_data_types = {}\r\n    \r\n    for column in dataframe.columns:\r\n        unique_types = set(type(value) for value in dataframe[column])\r\n        column_data_types[column] = unique_types\r\n    \r\n    return column_data_types\r\n```\r\nHere's the output of the column data types:\r\n```\r\n{\r\n    'AGE': set([<class 'int'>]),\r\n    'INDUSTRY': set([<class 'str'>]),\r\n    'STOCK_TYPE': set([<class 'str'>]),\r\n    'first_date': set([<class 'datetime.date'>]),\r\n    'last_date': set([<class 'datetime.date'>]),\r\n    'marketcap': set([<class 'float'>]),\r\n    'name': set([<class 'str'>]),\r\n    'symbol': set([<class 'str'>]),\r\n}\r\n```\r\n\r\nAs you can see, the function only found one datatype for each column.\r\n\r\nAlternatively, if I use pandas built in datatype command `dataframe.dtypes` I get the following:\r\n```\r\nsymbol         object\r\nname           object\r\nSTOCK_TYPE     object\r\nfirst_date     object\r\nlast_date      object\r\nAGE             int64\r\nINDUSTRY       object\r\nmarketcap     float64\r\ndtype: object\r\n```\r\nSo by both tests, each column has only one data type.  Though the .dtypes command shows \"object\" as the datatype.  Perhaps that's causing cudf to throw the error?\r\n\r\nHere is another example:\r\n```\r\n            date        NVDA\r\n0     1999-01-22    0.376356\r\n1     1999-01-25    0.415730\r\n2     1999-01-26    0.383428\r\n3     1999-01-27    0.382281\r\n4     1999-01-28    0.381134\r\n...          ...         ...\r\n6277  2024-01-03  475.690000\r\n6278  2024-01-04  479.980000\r\n6279  2024-01-05  490.970000\r\n6280  2024-01-08  522.530000\r\n6281  2024-01-09  531.400000\r\n```\r\nRunning the following:\r\n\r\n```\r\npprint(get_column_data_types(df))\r\npprint(df.dtypes)\r\n```\r\ngives you the following:\r\n\r\n```\r\n{'NVDA': set([<class 'float'>]), 'date': set([<class 'datetime.date'>])}\r\n\r\ndate     object\r\nNVDA    float64\r\ndtype: object\r\n```\r\nAs you can see, each column has only one data type.  Yet when I try to convert df to a cudf using cudf.from_pandas(df), it throws the same mixed type error.\r\n\r\n\r\n**Expected behavior**\r\nThere's no apparent mixtype column in the dataframe so it should be able to open the dataframe without throwing the mixedtype error.\r\n\r\n**Environment overview (please complete the following information)**\r\n - Environment location: Local machine.  PC running Win 11 using WSL2 Ubuntu\r\n - Method of cuDF install: pip\r\n\r\nCUDA 12 installed\r\nNVIDIA GTX 1080 graphics card\r\n\r\n\r\n**Environment details**\r\nError thrown in detail:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.10/runpy.py\", line 196, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"/usr/lib/python3.10/runpy.py\", line 86, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/notwopr/.local/lib/python3.10/site-packages/cudf/pandas/__main__.py\", line 91, in <module>\r\n    main()\r\n  File \"/home/notwopr/.local/lib/python3.10/site-packages/cudf/pandas/__main__.py\", line 87, in main\r\n    runpy.run_path(args.args[0], run_name=\"__main__\")\r\n  File \"/usr/lib/python3.10/runpy.py\", line 289, in run_path\r\n    return _run_module_code(code, init_globals, run_name,\r\n  File \"/usr/lib/python3.10/runpy.py\", line 96, in _run_module_code\r\n    _run_code(code, mod_globals, init_globals,\r\n  File \"/usr/lib/python3.10/runpy.py\", line 86, in _run_code\r\n    exec(code, run_globals)\r\n  File \"scratchp7.py\", line 29, in <module>\r\n    stockdatastats = FileOperations().readpkl(oldfn, DirPaths().full_info_db)\r\n  File \"/home/notwopr/beluga/beluga3/file_functions.py\", line 57, in readpkl\r\n    data = cudf.from_pandas(data)\r\n  File \"/home/notwopr/.local/lib/python3.10/site-packages/nvtx/nvtx.py\", line 115, in inner\r\n    result = func(*args, **kwargs)\r\n  File \"/home/notwopr/.local/lib/python3.10/site-packages/cudf/core/dataframe.py\", line 7891, in from_pandas\r\n    return DataFrame.from_pandas(obj, nan_as_null=nan_as_null)\r\n  File \"/home/notwopr/.local/lib/python3.10/site-packages/nvtx/nvtx.py\", line 115, in inner\r\n    result = func(*args, **kwargs)\r\n  File \"/home/notwopr/.local/lib/python3.10/site-packages/cudf/core/dataframe.py\", line 5237, in from_pandas\r\n    data[col_name] = column.as_column(\r\n  File \"/home/notwopr/.local/lib/python3.10/site-packages/cudf/core/column/column.py\", line 2279, in as_column\r\n    raise MixedTypeError(\"Cannot create column with mixed types\")\r\ncudf.errors.MixedTypeError: Cannot create column with mixed types\r\n```\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5xUKWo","author":{"login":"notwopr"},"authorAssociation":"NONE","body":"I found if I convert the date column that is in date.datetime datatype to pandas datetime format, it works:\r\nHere's the original dataframe:\r\n```\r\n            date        NVDA\r\n0     1999-01-22    0.376356\r\n1     1999-01-25    0.415730\r\n2     1999-01-26    0.383428\r\n3     1999-01-27    0.382281\r\n4     1999-01-28    0.381134\r\n...          ...         ...\r\n6277  2024-01-03  475.690000\r\n6278  2024-01-04  479.980000\r\n6279  2024-01-05  490.970000\r\n6280  2024-01-08  522.530000\r\n6281  2024-01-09  531.400000\r\n```\r\n\r\nI ran the following to convert the date column to pandas datetime datatype:\r\n```\r\ndf['date'] = pd.to_datetime(df['date'])\r\n```\r\n\r\nRan datatype check again and got the following:\r\n```\r\n{\r\n    'NVDA': set([<class 'float'>]),\r\n    'date': set([<class 'pandas._libs.tslibs.timestamps.Timestamp'>]),\r\n}\r\n\r\ndate    datetime64[ns]\r\nNVDA           float64\r\ndtype: object\r\n```\r\nAnd now when I run `cudf.from_pandas(df)`, I no longer get the error:\r\n\r\n```\r\nprint(cudf.from_pandas(df))\r\n           date        NVDA\r\n0    1999-01-22    0.376356\r\n1    1999-01-25    0.415730\r\n2    1999-01-26    0.383428\r\n3    1999-01-27    0.382281\r\n4    1999-01-28    0.381134\r\n...         ...         ...\r\n6277 2024-01-03  475.690000\r\n6278 2024-01-04  479.980000\r\n6279 2024-01-05  490.970000\r\n6280 2024-01-08  522.530000\r\n6281 2024-01-09  531.400000\r\n\r\n[6282 rows x 2 columns]\r\n```\r\n\r\n\r\n","createdAt":"2024-01-19T21:02:22Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14793#issuecomment-1901110696","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5xUKzj","author":{"login":"notwopr"},"authorAssociation":"NONE","body":"It seems even if a column is all just one datatype of date.datetime, it will throw the mixedtype error.  converting it to pandas datetime datetype cures it.   It'd be nice if cudf could accept date.datetime columns as is without the conversion.","createdAt":"2024-01-19T21:04:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14793#issuecomment-1901112547","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5xe5eB","author":{"login":"shwina"},"authorAssociation":"CONTRIBUTOR","body":"Thanks for reporting and for the thorough analysis! This issue stems from the fact that pandas uses the `object` datatype for storing `datetime.date` values:\r\n\r\n```python\r\nIn [1]: import pandas as pd\r\n\r\nIn [2]: import datetime\r\n\r\nIn [3]: s = pd.Series([datetime.date.fromisoformat(\"2001-01-01\"), datetime.date.fromisoformat(\"2001-01-02\")])\r\n\r\nIn [4]: s\r\nOut[4]:\r\n0    2001-01-01\r\n1    2001-01-02\r\n```\r\n\r\nNow, a pandas `Series` of `object` data type represents a collections of arbitrary python objects (possibly of differing types). When `cudf` sees such a `Series`, it tries to interpret the values either as strings, lists or dictionaries (data types that we support). If none of those work, we throw this error.\r\n\r\nI think it would be less confusing if we threw a `ValueError` here rather than a `MixedTypeError`, with a more general error message like `\"couldn't not convert values in column to a supported data type\"`.","createdAt":"2024-01-22T12:41:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14793#issuecomment-1903925121","viewerDidAuthor":false}],"createdAt":"2024-01-19T06:53:54Z","id":"I_kwDOBWUGps58j0AA","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NTk=","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"}],"milestone":null,"number":14793,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"MixedTypeError when there is no mixed type [BUG]","updatedAt":"2024-01-22T12:41:48Z","url":"https://github.com/rapidsai/cudf/issues/14793"}
