{"assignees":[],"author":{"id":"MDQ6VXNlcjU1ODg0NjQz","is_bot":false,"login":"shriramch","name":"Shriram Chandran"},"body":"I would like to implement a function that can generate AST expressions, for example, by recursively converting a different expression class, such as an Apache Arrow `arrow::compute::expression` [object](https://github.com/apache/arrow/blob/main/cpp/src/arrow/compute/expression.h), to a `cudf::ast::expression` [object](https://github.com/rapidsai/cudf/blob/branch-24.06/cpp/include/cudf/ast/expressions.hpp). \r\n\r\nIs this even possible? libcudf's AST expression classes only accept references that are owned by the caller function; this is a problem since we can not recurse anymore. Is there any way to do this, to implement functions that can generate AST expressions instead of hardcoding expressions in a caller?\r\n\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps581IRl","author":{"login":"bdice"},"authorAssociation":"CONTRIBUTOR","body":"@shriramch You can use an owning object like a `std::deque<expression>` or `std::list<expression>` where references are stable (`std::vector` can reallocate and invalidate references). The lifetime of the AST expressions would then be tied to the lifetime of that container, and you can return it or pass it around.","createdAt":"2024-05-04T17:00:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15653#issuecomment-2094302309","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps581Ibp","author":{"login":"bdice"},"authorAssociation":"CONTRIBUTOR","body":"For an example of constructing an expression tree, see this benchmark: https://github.com/rapidsai/cudf/blob/23bb2ed156d164b59e608e7e791c74db5cb4bce8/cpp/benchmarks/ast/transform.cpp#L65-L87","createdAt":"2024-05-04T17:01:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15653#issuecomment-2094302953","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps59I6jL","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"FWIW we'd also be OK with changing the current model, see #10744. If you would like to make that change, a PR is welcome!","createdAt":"2024-05-07T23:50:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15653#issuecomment-2099488971","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps59auyM","author":{"login":"shriramch"},"authorAssociation":"NONE","body":"@bdice Thank you, this approach worked.","createdAt":"2024-05-10T08:16:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15653#issuecomment-2104159372","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps59iaoD","author":{"login":"shriramch"},"authorAssociation":"NONE","body":"@vyasr Sure, I'd like to try this.","createdAt":"2024-05-12T09:01:53Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15653#issuecomment-2106173955","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps59-4to","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"@shriramch OK great! Feel free to post here if you need help in getting a development environment set up for cudf!","createdAt":"2024-05-15T23:21:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15653#issuecomment-2113637224","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-GF2G","author":{"login":"shriramch"},"authorAssociation":"NONE","body":"@vyasr Is it possible to get a remote development environment? Unfortunately I can't do this on my current PC.","createdAt":"2024-05-16T15:15:46Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15653#issuecomment-2115526022","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-Qul7","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"Would you be able to spin up an EC2 or GCP instance for this? I think getting access on one of the cloud services would be the easiest. [Paperspace](https://www.paperspace.com/) is another good option.","createdAt":"2024-05-17T20:09:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15653#issuecomment-2118314363","viewerDidAuthor":false}],"createdAt":"2024-05-04T16:10:19Z","id":"I_kwDOBWUGps6H2Dy4","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjQ=","name":"question","description":"Further information is requested","color":"D4C5F9"}],"milestone":null,"number":15653,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[QST] Recusively Generating AST Expressions (C++ libcudf)","updatedAt":"2024-05-19T04:05:55Z","url":"https://github.com/rapidsai/cudf/issues/15653"}
