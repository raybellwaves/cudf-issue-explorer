{"assignees":[],"author":{"id":"MDQ6VXNlcjIzNjY2ODQy","is_bot":false,"login":"er-eis","name":""},"body":"As @wence- points out here https://github.com/rapidsai/cudf/pull/15623#discussion_r1586054947\r\n\r\nWe allow concatenating indexes whilst `pandas` does not.\r\n\r\nDo we like this difference in behavior? Do we want parity? Would users be upset if we changed this behavior?","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps59I6H2","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"I don't think we want to support concatenating indexes, but I think cudf does rely on this behavior internally. I have a vague recollection of trying to remove this at one point and realizing that there were dependent changes required to make that happen. It looks like you've started adding deprecations for this in #15650, which is a great way to check this. Since our test suite runs with warnings as errors, if there are internal usages of concatenating indexes we'll see them as test failures there. Let's see how that goes!","createdAt":"2024-05-07T23:48:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2099487222","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps59I7Za","author":{"login":"er-eis"},"authorAssociation":"CONTRIBUTOR","body":"@vyasr assuming we have reasonable test coverage, based on my PR, the areas with dependent code are related to:\r\n1. `cudf` `Index`es (not a big shocker there)\r\n2. `cudf` parquets\r\n3. `dask_cudf` parquets\r\n4. `dask_cudf` accessor\r\n5. `dask_cudf` core","createdAt":"2024-05-07T23:55:40Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2099492442","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps59RPPI","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"OK awesome. It looks like you've started trying to catch those warnings in #15650, which is a good way to make sure that you've tracked down all the cases. However, I don't think we want to merge that exactly as is, because if we do then our users will start seeing a lot of warnings from APIs that they can't do anything about. We do want to verify that `cudf.concat` is itself going to throw the warning when users directly use it in a way that will be unsupported in the future, but we want to make sure that users don't see warnings due to our own code internally using deprecated functionality. We should start working through those APIs to see how best to rewrite them so that they don't rely on the deprecated functionality anymore. Does that make sense? Feel free to ask questions here (or on the PR)!","createdAt":"2024-05-08T23:44:36Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2101670856","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps59SDIi","author":{"login":"er-eis"},"authorAssociation":"CONTRIBUTOR","body":"@vyasr that makes sense, i'll set the PR to draft mode until i can work through 2, 3, 4, & 5 listed above (the only failing unit test for 1 directly calls `cudf.concat`, so i think we don't need an investigation there)","createdAt":"2024-05-09T03:52:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2101883426","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps59-6ww","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"Thanks! Feel free to let us know if you run into any issues and need some help.","createdAt":"2024-05-15T23:26:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2113645616","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-URyi","author":{"login":"er-eis"},"authorAssociation":"CONTRIBUTOR","body":"@vyasr & cc @wence- \r\n\r\n`dask` expects to be able to `concat` `Index` objects: https://github.com/dask/dask/blob/main/dask/dataframe/dispatch.py#L50\r\n\r\n`cudf` calls `dask`, which then calls the `concat` in `cudf` via this definition: https://github.com/rapidsai/cudf/blob/branch-24.06/python/dask_cudf/dask_cudf/backends.py#L276\r\n\r\nbased on the above, it seems to me that we need a function which supports the concatenation of `cudf.BaseIndex` objects. if you agree this is the case, then i think we shouldn't deprecate this functionality. some possibilities that come to mind (i am missing context here):\r\n1. move the concatenation of `cudf.BaseIndex` to a function other than `reshape`'s `concat`. make the func specific to `cudf.BaseIndex`. make a new `backends` func to handle this.\r\n2. leave the functionality in `reshape`'s `concat`, accept we diverge from `pandas` functionality for `concat`\r\n3. remove the associated calls to `dask` so we don't need to worry about what they're doing. this seems like something that wouldn't be worth our time\r\n4. convince the `dask` team to deprecate their concatenation? this seems like something not worth pursuing.\r\n\r\nwhat do you think?","createdAt":"2024-05-19T13:47:14Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2119244962","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-cL2P","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"Good analysis! You've found most of the relevant places, but what we ought to also look at is how dask implements concatenation for pandas indexes. It looks dask uses append for pandas indexes. You can see the implementation in dask for pandas dataframes [here](https://github.com/dask/dask/blob/main/dask/dataframe/backends.py#L562). The append method [was removed for Series and DataFrame in pandas 2.0](https://pandas.pydata.org/docs/dev/whatsnew/v2.0.0.html#removal-of-prior-version-deprecations-changes), but [it still exists for indexes](https://pandas.pydata.org/docs/reference/api/pandas.Index.append.html). So what we probably want to do is update the dispatch in the dask_cudf backend that you linked to to use the index append method.\r\n\r\nIn the long run, we might want to discuss with pandas developers whether there should be more uniformity between the different types and whether they use append or concat. @mroeschke might know how and why pandas ended up in the current heterogeneous state. However, any such changes in pandas would be a longer-term thing, so we should be able to proceed with the above plan in the interim.","createdAt":"2024-05-20T22:25:35Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2121317775","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-dBwp","author":{"login":"er-eis"},"authorAssociation":"CONTRIBUTOR","body":"thanks so much for the context, @vyasr! i'll plan to proceed with 1 via the usage of index append -- to me, the implementation in dask pandas is ugly. i think it'd be easier to follow if we separated indices from other objects","createdAt":"2024-05-21T01:35:29Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2121538601","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-jVyq","author":{"login":"mroeschke"},"authorAssociation":"CONTRIBUTOR","body":"> In the long run, we might want to discuss with pandas developers whether there should be more uniformity between the different types and whether they use append or concat. @mroeschke might know how and why pandas ended up in the current heterogeneous state. \r\n\r\nIIRC `pandas.Series.append` and `pandas.DataFrame.append` were deprecated because similar and more performance functionality existed in `pandas.concat`; however, `pandas.concat` never worked on `pandas.Index` objects that why `.append` exists on `pandas.Index`.\r\n\r\nI'm not sure if `pandas.concat` will ever support `pandas.Index` objects though since it's used for \"concat pandas objects that have axes\"","createdAt":"2024-05-21T18:23:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2123193514","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5-kzZS","author":{"login":"vyasr"},"authorAssociation":"CONTRIBUTOR","body":"Hmm OK yeah I guess that sort of makes sense. I really wish there were fewer ways in which we needed to special-case for indexes.","createdAt":"2024-05-21T23:12:51Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15649#issuecomment-2123576914","viewerDidAuthor":false}],"createdAt":"2024-05-04T04:31:14Z","id":"I_kwDOBWUGps6H0poS","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NTk=","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":15649,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[BUG] Concat `Index` behavior diverts from `pandas`","updatedAt":"2024-05-21T23:12:52Z","url":"https://github.com/rapidsai/cudf/issues/15649"}
