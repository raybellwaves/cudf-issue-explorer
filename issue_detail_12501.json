{"assignees":[],"author":{"id":"MDQ6VXNlcjU4MzAxMzE2","is_bot":false,"login":"lvxhnat","name":"Yi Kuang"},"body":"Hi all, I have a dataframe that is ~19K Rows, ~11.4 MB (Profiled using ```df.info(memory_usage = \"deep\")```). We are currently running into CPU out of memory issues and so profiling our memory using this sample dataset. As you can see in the screenshot attached, there is a jump in mem usage, from 840MiB -> 4148MiB, during the type conversion of ```df```. Image below shows the dataframe memory usage after conversion. \r\n\r\nMy question is: Why is there a jump in the memory usage when converting a dataframe from pandas to cudf? Furthermore, this memory is not released after, and so increases from this point in following processing steps.\r\n\r\n<img width=\"508\" alt=\"Screenshot 2023-01-09 at 6 08 11 PM\" src=\"https://user-images.githubusercontent.com/58301316/211284128-f093d906-cdb5-42b9-9ea8-79d4ff237f95.png\">\r\n<img width=\"1179\" alt=\"Screenshot 2023-01-10 at 11 16 09 AM\" src=\"https://user-images.githubusercontent.com/58301316/211454005-c39e9bf0-393c-4bbc-83ad-9e9f23783991.png\">\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5X3Vyl","author":{"login":"GregoryKimball"},"authorAssociation":"CONTRIBUTOR","body":"Thank you @lvxhnat for sharing these results. Would you please post a code snippet that reproduces the issue?","createdAt":"2023-03-17T16:53:16Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/12501#issuecomment-1474124965","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5YewCM","author":{"login":"lvxhnat"},"authorAssociation":"NONE","body":"@GregoryKimball  Hi Gregory, apologies for the late reply. This issue seems to be general and not specific to my dataset. This is what I did to replicate: \r\n\r\nIn file ```df_memory_test.py```\r\n```python\r\nimport cudf\r\nimport numpy as np\r\nimport pandas as pd\r\nfrom memory_profiler import profile\r\n\r\n@profile\r\ndef df_memory_test():\r\n    rands = [np.random.random(1000) for i in range(3)]\r\n    pd_df: pd.DataFrame = pd.DataFrame(rands).T\r\n    pd_df.columns = ['sample_a', 'sample_b', 'sample_c']\r\n    cu_df: cudf.DataFrame = cudf.DataFrame(pd_df)\r\n    return \r\n\r\nif __name__ ==  '__main__':\r\n   df_memory_test()\r\n```\r\n\r\nthen ```python -m memory_profiler df_memory_test.py```\r\n\r\nshows a memory spike during the conversion similarly:\r\n\r\n```\r\nLine #    Mem usage    Increment  Occurrences   Line Contents\r\n=============================================================\r\n     6    596.6 MiB    596.6 MiB           1   @profile\r\n     7                                         def df_memory_test():\r\n     8    596.6 MiB      0.0 MiB           6       rands = [np.random.random(1000) for i in range(3)]\r\n     9    597.4 MiB      0.8 MiB           1       pd_df: pd.DataFrame = pd.DataFrame(rands).T\r\n    10    597.4 MiB      0.0 MiB           1       pd_df.columns = ['sample_a', 'sample_b', 'sample_c']\r\n    11   2436.6 MiB   1839.2 MiB           1       cu_df: cudf.DataFrame = cudf.DataFrame(pd_df)\r\n    12   2436.6 MiB      0.0 MiB           1       return \r\n```","createdAt":"2023-03-27T04:03:48Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/12501#issuecomment-1484456076","viewerDidAuthor":false}],"createdAt":"2023-01-09T10:09:07Z","id":"I_kwDOBWUGps5a6ec4","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjQ=","name":"question","description":"Further information is requested","color":"D4C5F9"},{"id":"MDU6TGFiZWwxMDEzOTg3MzUy","name":"0 - Backlog","description":"In queue waiting for assignment","color":"d4c5f9"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"}],"milestone":{"number":20,"title":"Stabilizing large workflows (OOM, spilling, partitioning)","description":"","dueOn":null},"number":12501,"projectCards":[{"project":{"name":"Other Issues"},"column":{"name":"Needs prioritizing"}}],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[QST] CPU memory spike during cudf dataframe conversion","updatedAt":"2024-05-17T15:58:50Z","url":"https://github.com/rapidsai/cudf/issues/12501"}
