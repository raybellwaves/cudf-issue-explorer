{"assignees":[],"author":{"id":"MDQ6VXNlcjExMjY5ODE=","is_bot":false,"login":"wence-","name":"Lawrence Mitchell"},"body":"`Series.map` which substitutes values in `self` that match some key with its corresponding value does:\r\n```\r\n            lhs = cudf.DataFrame({\"x\": self, \"orig_order\": arange(len(self))})\r\n            rhs = cudf.DataFrame(\r\n                {\r\n                    \"x\": arg.keys(),\r\n                    \"s\": arg.values(),\r\n                    \"bool\": full(len(arg), True, dtype=self.dtype),\r\n                }\r\n            )\r\n            res = lhs.merge(rhs, on=\"x\", how=\"left\").sort_values(\r\n                by=\"orig_order\"\r\n            )\r\n            result = res[\"s\"]\r\n            result.name = self.name\r\n            result.index = self.index\r\n```\r\n\r\nSo the order is the same as the input.\r\n\r\nThis has two pessimisations:\r\n\r\n1. In pandas-compat mode (since #14428) this merge doesn't need sorting\r\n2. Since we only return `s`, we can get away with `sort_by_key` of `res[\"s\"]` rather than sorting a multi-column dataframe","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5swn7a","author":{"login":"wence-"},"authorAssociation":"CONTRIBUTOR","body":"cross-ref #6724","createdAt":"2023-11-23T16:20:52Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14485#issuecomment-1824685786","viewerDidAuthor":false}],"createdAt":"2023-11-23T15:12:00Z","id":"I_kwDOBWUGps53tfK6","labels":[{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"},{"id":"MDU6TGFiZWwxMzIyMjUyNjE3","name":"Performance","description":"Performance related issue","color":"C2E0C6"},{"id":"LA_kwDOBWUGps8AAAABc-htjg","name":"no-oom","description":"Reducing memory footprint of cudf algorithms","color":"FBCA04"}],"milestone":null,"number":14485,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[PERF/ENH] `Series.map` sorts a larger dataset than it needs to","updatedAt":"2023-11-23T16:20:54Z","url":"https://github.com/rapidsai/cudf/issues/14485"}
