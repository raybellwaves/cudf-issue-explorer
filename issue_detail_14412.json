{"assignees":[],"author":{"id":"MDQ6VXNlcjE0ODc2NTg1","is_bot":false,"login":"divyegala","name":"Divye Gala"},"body":"We should be able to use nested-type columns as values and still be able to invoke a hash-based groupby, as hash-based is generally faster so we do not want to be silently using sort-based. https://github.com/rapidsai/cudf/blob/abc0d41d1d9033d581948ae19384e0aa0f33da77/cpp/src/groupby/hash/groupby.cu#L654-L656\r\n\r\nReference thread: https://github.com/rapidsai/cudf/pull/13795#discussion_r1373454172","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5r82-7","author":{"login":"bdice"},"authorAssociation":"CONTRIBUTOR","body":"This code block is the piece in question:\r\n\r\nhttps://github.com/rapidsai/cudf/blob/b446a6f187241e765c925da1053ece2679313a06/cpp/src/groupby/hash/groupby.cu#L654-L656\r\n\r\n@ttnghia, you added this in #13676. Do you know if this fallback is still required, or why?\r\n\r\nWe discussed this a bit here: https://github.com/rapidsai/cudf/pull/13676#discussion_r1260196703\r\n\r\nSide note, I'm punching my past self -- I asked this question on that PR, and never submitted my review: \r\n![image](https://github.com/rapidsai/cudf/assets/3943761/01e9d6f3-f021-44b0-91cf-235fe57d340e)\r\n","createdAt":"2023-11-14T19:50:43Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"LAUGH","users":{"totalCount":1}}],"url":"https://github.com/rapidsai/cudf/issues/14412#issuecomment-1811115963","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5r9CDT","author":{"login":"ttnghia"},"authorAssociation":"CONTRIBUTOR","body":"> @ttnghia, you added this in #13676. Do you know if this fallback is still required, or why?\r\n\r\nBecause hash-based aggregations are implemented for plain type only, using the operator such as `<` instead of user-provided comparator. See `struct update_target_element` in `cpp/include/cudf/detail/aggregation/aggregation.cuh`.\r\n\r\nIf we want to support hash-based aggregates for nested types, we need to rewrite such `struct update_target_element` such that we can compare rows using a row comparator instead.","createdAt":"2023-11-14T20:11:15Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14412#issuecomment-1811161299","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5r9M3O","author":{"login":"bdice"},"authorAssociation":"CONTRIBUTOR","body":"Great, that was helpful. I think we can do this. I think the rough plan would be to preprocess the table so we have device comparators that can be used, pass the preprocessed table info through all the aggregation machinery, and use the device comparator where needed in `update_target_element`. Does that sound right to you?\r\n","createdAt":"2023-11-14T20:32:37Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/14412#issuecomment-1811205582","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5r9TSe","author":{"login":"ttnghia"},"authorAssociation":"CONTRIBUTOR","body":"Yes that sounds good. Note that we only need to rework for `ARGMIN` and `ARGMAX` (other aggregations are `SUM`, `PRODUCT` etc that can't support nested types), not for everything thus the amount of work should not be very heavy.","createdAt":"2023-11-14T20:38:21Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"url":"https://github.com/rapidsai/cudf/issues/14412#issuecomment-1811231902","viewerDidAuthor":false}],"createdAt":"2023-11-14T19:44:30Z","id":"I_kwDOBWUGps520Y5t","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NTk=","name":"bug","description":"Something isn't working","color":"d73a4a"},{"id":"MDU6TGFiZWwxMDEzOTg3MzUy","name":"0 - Backlog","description":"In queue waiting for assignment","color":"d4c5f9"},{"id":"MDU6TGFiZWwxMTM5NzQwNjY2","name":"libcudf","description":"Affects libcudf (C++/CUDA) code.","color":"c5def5"},{"id":"MDU6TGFiZWwxMzIyMjUyNjE3","name":"Performance","description":"Performance related issue","color":"C2E0C6"}],"milestone":{"number":28,"title":"Aggregations continuous improvement","description":"","dueOn":null},"number":14412,"projectCards":[],"projectItems":[],"reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}}],"state":"OPEN","title":"Groupby hash aggregations use sort-based implementation if nested-type columns are used as values","updatedAt":"2023-12-14T18:46:43Z","url":"https://github.com/rapidsai/cudf/issues/14412"}
