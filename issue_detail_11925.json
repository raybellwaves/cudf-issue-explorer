{"assignees":[],"author":{"id":"MDQ6VXNlcjQzODYyODcw","is_bot":false,"login":"dawilliams-nvidia","name":""},"body":"**Is your feature request related to a problem? Please describe.**\r\nThe cudf documentation lists the mode function's {axis=0,1} parameter, but then has an additional note that \"axis parameter is currently not supported.\":  https://docs.rapids.ai/api/cudf/stable/api_docs/api/cudf.DataFrame.mode.html \r\n\r\n**Describe the solution you'd like**\r\nIs this feature possible to be implemented? Or is there an underlying challenge with replicating this pandas functionality in cudf?\r\n\r\n**Additional context**\r\nNVIDIA Solutions Architect, filing on behalf of customer\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5Mb_C5","author":{"login":"shwina"},"authorAssociation":"CONTRIBUTOR","body":"In general, `axis=1` for other methods like `max()` or `mean()` is supported via CuPy, which doesn't provide `mode()`.\r\n\r\nI don't think it would be trivial or easy to implement `mode()` as it effectively needs a row-wise stream compaction. @GregoryKimball or @brandon-b-miller -- I wonder if you have any thoughts on the feasibility of implementing this using libcudf or numba respectively?\r\n","createdAt":"2022-10-18T13:39:47Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/11925#issuecomment-1282404537","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5McQit","author":{"login":"brandon-b-miller"},"authorAssociation":"CONTRIBUTOR","body":"It seems like it would be possible to write a numba kernel that consumes a matrix-like data structure (possibly generated from the input dataframe) and computes the mode across the rows, however I think the challenge for us in cuDF would be making sure that kernel (or family of kernels) matches pandas for all the edge cases involving dataframes with mixed dtypes, nulls, nans, and the like. We'd also want to think about the UX of dispatching to cupy for some row-wise operations and a custom numba kernel which requires compilation for others. ","createdAt":"2022-10-18T14:20:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/11925#issuecomment-1282476205","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5McSb0","author":{"login":"beckernick"},"authorAssociation":"MEMBER","body":"I agree. This is probably in scope for CuPy, as SciPy explicitly implements it (with a fairly interesting return type). Given this operation is not columnar in nature, I think it makes sense to implement this in the Python layer by dispatching to a potential future CuPy implementation.","createdAt":"2022-10-18T14:25:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/11925#issuecomment-1282483956","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5NNHJ1","author":{"login":"beckernick"},"authorAssociation":"MEMBER","body":"Per offline discussion with @dawilliams-nvidia , limited support for only numeric types would be sufficient","createdAt":"2022-10-28T17:47:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/11925#issuecomment-1295282805","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5NNbDn","author":{"login":"bdice"},"authorAssociation":"CONTRIBUTOR","body":"If numeric-only types are sufficient here, I would suggest the same thing as I mentioned here: https://github.com/rapidsai/cudf/issues/11570#issuecomment-1221119749\r\n\r\nWe can implement something like `axis=1` by returning `df.T.mode(axis=0).T`. The explicit transposes will only work for dataframes with similar dtypes (I am not exactly sure what qualifies for like-casting on tranpose) but it would permit a reasonable subset of `axis=1` use cases to be performed in a fairly efficient manner. The two transposes are not ideal for speed, but neither is row-wise operation. This might be an okay compromise between GPU perf and usability.\r\n\r\n@shwina @beckernick @brandon-b-miller Do we have other issues like this where CuPy is limiting us? I suspect similar issues would exist for cuDF types that CuPy doesn't support, but a (transpose, columnar reduction, transpose) could be viable.","createdAt":"2022-10-28T19:16:40Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/11925#issuecomment-1295364327","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5NNmnw","author":{"login":"beckernick"},"authorAssociation":"MEMBER","body":"We changed transpose to return a contiguous buffer, right? I think that allocating thousands of columns will be a non-starter.","createdAt":"2022-10-28T20:01:54Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/11925#issuecomment-1295411696","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5NOdpW","author":{"login":"shwina"},"authorAssociation":"CONTRIBUTOR","body":"> We changed transpose to return a contiguous buffer, right?\r\n\r\nIndeed we did.","createdAt":"2022-10-28T23:26:02Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/11925#issuecomment-1295637078","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5NOgHF","author":{"login":"bdice"},"authorAssociation":"CONTRIBUTOR","body":"I see. An alternative would be to allocate a single column that is matrix-like (has `columns*rows` entries), copy all the entries there (no need to transpose), and add an auxiliary column of row labels. Then do a groupby count over both columns `(row_label, value)` to get the counts of each value in each row. Take the result and do a groupby argmax over `row_label` to get the index of the mode of each row, and gather the corresponding values to return.\r\n\r\nThe first groupby cardinality could be very large with low counts for each grouping, but both groupby steps can use hash-based implementations.","createdAt":"2022-10-28T23:51:12Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/11925#issuecomment-1295647173","viewerDidAuthor":false}],"createdAt":"2022-10-14T18:08:52Z","id":"I_kwDOBWUGps5UBidE","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjE=","name":"feature request","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxMTM5NzQwNjY2","name":"libcudf","description":"Affects libcudf (C++/CUDA) code.","color":"c5def5"},{"id":"MDU6TGFiZWwxMTM5NzQxMjEz","name":"cuDF (Python)","description":"Affects Python cuDF API.","color":"1d76db"}],"milestone":null,"number":11925,"projectCards":[{"project":{"name":"Feature Planning"},"column":{"name":"Needs prioritizing"}},{"project":{"name":"v22.12 Release"},"column":{"name":"Issue-Needs prioritizing"}}],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[FEA] dataframe.mode() axis parameter not supported","updatedAt":"2022-10-28T23:52:35Z","url":"https://github.com/rapidsai/cudf/issues/11925"}
