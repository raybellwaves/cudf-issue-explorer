{"assignees":[],"author":{"id":"MDQ6VXNlcjExNjY0MjU5","is_bot":false,"login":"galipremsagar","name":"GALI PREM SAGAR"},"body":"**Describe the bug**\r\nThere are various issues with `codecov` I'm trying to summarize into one master issue.\r\n1. The `codecov/patch` custom github action doesn't always seem to be posted on the PR. Last PR that had this posted on was: https://github.com/rapidsai/cudf/pull/15719\r\n<img width=\"851\" alt=\"Screenshot 2024-05-20 at 6 53 12 AM\" src=\"https://github.com/rapidsai/cudf/assets/11664259/6173fc79-3b1f-434e-9d94-d33a12aa79fb\">\r\n\r\n2. `codecov` bot seems to have stopped commenting on PRs the diff coverage as it used to:\r\n<img width=\"1197\" alt=\"Screenshot 2024-05-20 at 6 54 30 AM\" src=\"https://github.com/rapidsai/cudf/assets/11664259/978a924a-96be-42a4-b214-bd0088dcf9af\">\r\n\r\n3. The base branch coverage is off by a few lines always because we generate the coverage by running the tests nightly are there any best practices and recommendations from `codecov` team on how to have a very upto-date base branch coverage?\r\n\r\n","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps5-j6zd","author":{"login":"bdice"},"authorAssociation":"CONTRIBUTOR","body":"I had a call with a couple folks from Sentry (who create Codecov), Sabiha and Vlad. We talked through a few topics related to coverage in RAPIDS.\r\n\r\n- Codecov's carryforward option may help us with the problems we face with only running CI on a nightly basis. This may resolve (3) above. We may want to use `-F <component>` (like `-F cudf`) so that we can more easily determine coverage for each part of a repository.\r\n\r\n- I requested a feature in Codecov. The UI for Codecov should have an option to stay in sync with the GitHub default branch (currently https://app.codecov.io/gh/rapidsai/cudf/ uses branch-23.06, which is a year old). Currently the branch must be manually adjusted, and we don't want to add work to the release process. Vlad will see what can be done on their side (a UI option to stay in sync with GitHub would be ideal).\r\n\r\n- I reported a bug in Codecov: the \"latest commit\" reported for [branch-24.06](https://app.codecov.io/gh/rapidsai/cudf/tree/branch-24.06) on Codecov is 2 weeks old. However, there are newer coverage reports on [the commit list for branch-24.06](https://app.codecov.io/gh/rapidsai/cudf/commits?branch=All%20branches). Vlad said this seems to be a bug and they'll take a look.\r\n\r\n- On the RAPIDS side, [we're getting rate limited](https://github.com/rapidsai/cudf/actions/runs/9124031981/job/25087473694#step:9:77) during Codecov uploads, which prevents us from getting full coverage reports on every nightly test run. Copying from that log below for posterity:\r\n```\r\n[2024-05-17T07:24:36.632Z] ['info'] Pinging Codecov: https://codecov.io/upload/v4?package=uploader-0.7.2&token=*******&branch=branch-24.06&build=9124031981&build_url=https%3A%2F%2Fgithub.com%2Frapidsai%2Fcudf%2Factions%2Fruns%2F9124031981&commit=6d5f9653debe57c7eb52f42fb980d38451a9a460&job=test&pr=&service=github-actions&slug=rapidsai%2Fcudf&name=&tag=&flags=&parent=\r\n[2024-05-17T07:24:36.632Z] ['verbose'] Passed token was 0 characters long\r\n[2024-05-17T07:24:36.632Z] ['verbose'] https://codecov.io/upload/v4?package=uploader-0.7.2&branch=branch-24.06&build=9124031981&build_url=https%3A%2F%2Fgithub.com%2Frapidsai%2Fcudf%2Factions%2Fruns%2F9124031981&commit=6d5f9653debe57c7eb52f42fb980d38451a9a460&job=test&pr=&service=github-actions&slug=rapidsai%2Fcudf&name=&tag=&flags=&parent=\r\n        Content-Type: 'text/plain'\r\n        Content-Encoding: 'gzip'\r\n        X-Reduced-Redundancy: 'false'\r\n[2024-05-17T07:24:36.844Z] ['error'] There was an error running the uploader: Error uploading to [https://codecov.io:](https://codecov.io/) Error: There was an error fetching the storage URL during POST: 429 - {'detail': ErrorDetail(string='Rate limit reached. Please upload with the Codecov repository upload token to resolve issue. Expected time to availability: 681s.', code='throttled')}\r\n[2024-05-17T07:24:36.846Z] ['verbose'] The error stack is: Error: Error uploading to [https://codecov.io:](https://codecov.io/) Error: There was an error fetching the storage URL during POST: 429 - {'detail': ErrorDetail(string='Rate limit reached. Please upload with the Codecov repository upload token to resolve issue. Expected time to availability: 681s.', code='throttled')}\r\n    at main (/snapshot/repo/dist/src/index.js)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n[2024-05-17T07:24:36.846Z] ['verbose'] End of uploader: 532 milliseconds\r\n[2024-05-17T07:24:36.846Z] ['info'] Codecov will exit with status code 0. If you are expecting a non-zero exit code, please pass in the `-Z` flag\r\n```\r\nWe need to check on the GitHub application configuration and make sure it's set up correctly. We should also update to the newer Codecov CLI to upload, and use an organization token to authenticate our uploads. Currently we are using the older Codecov uploader (see the install step and [shared-workflows call](https://github.com/rapidsai/shared-workflows/blob/19d17957e59cf81574f214e043adf8cff7db9447/.github/workflows/conda-python-tests.yaml#L151-L154)).","createdAt":"2024-05-21T19:58:27Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/15783#issuecomment-2123345117","viewerDidAuthor":false}],"createdAt":"2024-05-20T11:59:36Z","id":"I_kwDOBWUGps6JcE1P","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NTk=","name":"bug","description":"Something isn't working","color":"d73a4a"}],"milestone":null,"number":15783,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[BUG] Issues with `codecov` on `cudf` CI","updatedAt":"2024-05-21T19:58:28Z","url":"https://github.com/rapidsai/cudf/issues/15783"}
