{"assignees":[],"author":{"id":"MDQ6VXNlcjgxNjY0MTk=","is_bot":false,"login":"res-life","name":"Chong Gao"},"body":"**Is your feature request related to a problem? Please describe.**\r\nThe sample without replacement is slower than the CPU.\r\n\r\n**Additional context**\r\nWith replacement is really fast. \r\nThis indicates that thrust::shuffle_copy is the reason for the slowness.\r\n```\r\n// replacement is true\r\nspark.time(spark.range(Int.MaxValue * 12L).sample(true, 0.01, 0).selectExpr(\"SUM(id)\", \"COUNT(id)\").show())\r\n+-------------------+---------+\r\n|            sum(id)|count(id)|\r\n+-------------------+---------+\r\n|3320410258800588221|257697960|\r\n+-------------------+---------+\r\nTime taken: 670 ms\r\n\r\n// without replacement\r\nscala> spark.time(spark.range(Int.MaxValue).sample(0.01, 0).agg(functions.sum(\"id\")).show())\r\n+-----------------+                                                             \r\n|          sum(id)|\r\n+-----------------+\r\n|23058247476802342|\r\n+-----------------+\r\n\r\nTime taken: 1608 ms\r\n```\r\n\r\n[Sample code link](https://github.com/rapidsai/cudf/blob/branch-22.02/cpp/include/cudf/copying.hpp#L935)","closed":false,"closedAt":null,"comments":[{"id":"IC_kwDOBWUGps46vs9r","author":{"login":"revans2"},"authorAssociation":"CONTRIBUTOR","body":"It would be nice to see if there is some way that we could speed this up. As it is right now the performance of this version is on par with the CPU version or slightly slower.  Note that this is against 12 CPU cores, so it still is faster than a single core, but no one is running a single GPU vs a single CPU core typically.","createdAt":"2021-12-03T14:53:05Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/9834#issuecomment-985583467","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps47-BJb","author":{"login":"github-actions"},"authorAssociation":"NONE","body":"This issue has been labeled `inactive-30d` due to no recent activity in the past 30 days. Please close this issue if no further response or action is needed. Otherwise, please respond with a comment indicating any updates or changes to the original issue and/or confirm this issue still needs to be addressed. This issue will be labeled `inactive-90d` if there is no activity in the next 60 days.","createdAt":"2022-01-05T22:02:59Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/9834#issuecomment-1006113371","viewerDidAuthor":false},{"id":"IC_kwDOBWUGps5A8FzR","author":{"login":"github-actions"},"authorAssociation":"NONE","body":"This issue has been labeled `inactive-90d` due to no recent activity in the past 90 days. Please close this issue if no further response or action is needed. Otherwise, please respond with a comment indicating any updates or changes to the original issue and/or confirm this issue still needs to be addressed.","createdAt":"2022-04-05T23:03:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/rapidsai/cudf/issues/9834#issuecomment-1089494225","viewerDidAuthor":false}],"createdAt":"2021-12-03T09:29:34Z","id":"I_kwDOBWUGps4_zNvB","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjE=","name":"feature request","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxMDEzOTg3MzUy","name":"0 - Backlog","description":"In queue waiting for assignment","color":"d4c5f9"},{"id":"MDU6TGFiZWwxMTM5NzQwNjY2","name":"libcudf","description":"Affects libcudf (C++/CUDA) code.","color":"c5def5"},{"id":"MDU6TGFiZWwxMzIyMjUyNjE3","name":"Performance","description":"Performance related issue","color":"C2E0C6"},{"id":"MDU6TGFiZWwxNDA1MTQ2OTc1","name":"Spark","description":"Functionality that helps Spark RAPIDS","color":"7400ff"}],"milestone":null,"number":9834,"projectCards":[{"project":{"name":"Feature Planning"},"column":{"name":"Needs prioritizing"}}],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[FEA] Improve the performance of sample","updatedAt":"2022-04-07T15:58:19Z","url":"https://github.com/rapidsai/cudf/issues/9834"}
