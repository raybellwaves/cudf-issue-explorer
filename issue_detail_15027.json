{"assignees":[{"id":"MDQ6VXNlcjIwNDYxMDEz","login":"rjzamora","name":"Richard (Rick) Zamora"}],"author":{"id":"MDQ6VXNlcjIwNDYxMDEz","is_bot":false,"login":"rjzamora","name":"Richard (Rick) Zamora"},"body":"## PSA\r\n\r\nTo unblock CI failures related to the dask-expr migration, down-stream RAPIDS libraries can set the following environment variable in CI (before `dask.dataframe`/`dask_cudf` is ever imported):\r\n\r\n```\r\nexport DASK_DATAFRAME__QUERY_PLANNING=False\r\n```\r\n\r\n**If you do this, please be sure to comment on the change, and link it to this meta issue.** (So I can make the necessary changes/fixes, and turn query-planning back on)\r\n\r\n\r\n____\r\n\r\n## Background\r\n\r\nThe `2024.2.0` release of Dask has deprecated the \"legacy\" `dask.dataframe` API. Given that dask-cudf (and much of RAPIDS) is tightly integrated with `dask.dataframe`, it is critical that `dask_cudf` be updated to use the new `dask_expr` backend smoothly.\r\n\r\nMost of the heavy lifting is already being done in https://github.com/rapidsai/cudf/pull/14805. However, there will also be some follow-up work to expand coverage/examples/documentation/benchmarks. We will also need to update dask-cuda/explicit-comms.\r\n\r\n## Action Items\r\n\r\n**Basics** (to be covered by https://github.com/rapidsai/cudf/pull/14805):\r\n- [x] Add dask-expr `DataFrameBackendEntrypoint` entrypoint for \"cudf\"\r\n- [x] Align top-level `dask_cudf` imports with `dask.dataframe` for `\"dataframe.query-planning\"` support\r\n\r\n**Expected Follow-up**:\r\n- [x] Add `read_json` support (https://github.com/rapidsai/cudf/pull/15408)\r\n- [x] Add `read_orc` support (https://github.com/rapidsai/cudf/pull/15439)\r\n- [ ] `read_parquet` should always return DataFrame (not currently the case in dask-expr if `columns=<str>`)\r\n- [ ] Remove outdated `check_file_size` functionality from `dask_cudf.read_parquet`\r\n- [x] Add s3 testing/support (https://github.com/rapidsai/cudf/pull/15408)\r\n- [x] Add `read_text` support (https://github.com/rapidsai/cudf/pull/15439)\r\n- [x] Fix unexplained test failures for categorical accessors (https://github.com/rapidsai/cudf/pull/15591)\r\n- [x] Deprecate `to_dask_dataframe` API in favor of `to_backend` (https://github.com/rapidsai/cudf/pull/15592)\r\n- [x] Deprecate `set_index(..., divisions=\"quantile\")` (https://github.com/rapidsai/cudf/pull/15804)\r\n- [x] Add `describe` support (seems to be working now? Just need to remove `xfail` markers)\r\n- [x] Add `groupby` \"collect\" support (https://github.com/rapidsai/cudf/pull/15593)\r\n- [ ] (Maybe?) add `as_index` support to `groupby`\r\n- [x] Fix `get_dummy` support (https://github.com/dask/dask-expr/pull/1053)\r\n- [ ] Fix sorting by categorical columns (https://github.com/rapidsai/cudf/pull/15701; **Related Issues**: https://github.com/rapidsai/cudf/issues/15641 & https://github.com/dask/dask/issues/11090 & https://github.com/rapidsai/cudf/pull/15801)\r\n- [x] Fix sorting with nulls (https://github.com/rapidsai/cudf/pull/15639)\r\n- [ ] `leftanti` merge support (Likely an error message in 24.06 and support in 24.08+)\r\n- [x] `to_datetime` support (https://github.com/dask/dask-expr/pull/1035)\r\n- [x] Add `melt` support (https://github.com/dask/dask-expr/pull/1049 & https://github.com/dask/dask/pull/11088)\r\n\r\n**cuDF / Dask cuDF doc build**:\r\n- [x] Revert https://github.com/rapidsai/cudf/pull/15343 (see: https://github.com/rapidsai/cudf/pull/15347)\r\n\r\n**cuML support**:\r\n- [x] [General debugging PR](https://github.com/rapidsai/cuml/pull/5835)\r\n\r\n**cuxfilter support**:\r\n- [x] (https://github.com/rapidsai/cuxfilter/pull/583, https://github.com/rapidsai/cuxfilter/pull/593)\r\n\r\n**cugraph support**:\r\n- [x] [General debugging PR](https://github.com/rapidsai/cugraph/pull/4325)\r\n\r\n**Dask CUDA**:\r\n- [ ] Explicit comms support (https://github.com/rapidsai/dask-cuda/issues/1311)\r\n\r\n**Dask SQL**:\r\n- [ ] Migrate predicate pushdown to dask-expr\r\n\r\n**NeMo Curator**:\r\n- [ ] Migrate custom-graph code and test against latest dask/cudf\r\n\r\n**Merlin**:\r\n- [ ] Port Merlin/NVTabular (Heavy lift - Aiming for 24.08)\r\n","closed":false,"closedAt":null,"comments":[],"createdAt":"2024-02-12T17:33:04Z","id":"I_kwDOBWUGps5-_rMS","labels":[{"id":"MDU6TGFiZWw1OTk2MjY1NjE=","name":"feature request","description":"New feature or request","color":"a2eeef"},{"id":"MDU6TGFiZWwxMTg1MjQwODk4","name":"dask","description":"Dask issue","color":"fcc25d"}],"milestone":null,"number":15027,"projectCards":[],"projectItems":[],"reactionGroups":[],"state":"OPEN","title":"[FEA] Support \"dataframe.query-planning\" config in ``dask.dataframe``","updatedAt":"2024-05-28T14:49:25Z","url":"https://github.com/rapidsai/cudf/issues/15027"}
